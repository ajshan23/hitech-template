import{r as a,a9 as U,j as e,ah as c}from"./index-DzuwMUJk.js";import{A as V}from"./AdaptableCard-BeBKmGTY.js";import{O as X,a0 as Y,a1 as Z,F as ee}from"./toString-wyiJ7teT.js";import{D as te}from"./DataTable-CT4zEuIH.js";import{B as h}from"./Button-wjgR3boE.js";import{D as P}from"./Drawer-DfVTzd_2.js";import{t as g,N as b}from"./toast-CcPug4ol.js";import{I as z}from"./Input-Brks8ori.js";import{C as ae}from"./index-DwclNWPp.js";import{d as se}from"./debounce-DIqprdcr.js";import"./Card-zb4SO3fb.js";import"./Views-B7C5aCBY.js";import"./index-BAVH9xHy.js";import"./index-DEq-6zJ9.js";import"./Skeleton-BvSpIA5c.js";import"./Select-D4hXbUsF.js";import"./get-CYTsGD9q.js";import"./context-DYzOV7Yr.js";import"./index-CxIgI4X0.js";import"./useColorLevel-10S34ZEH.js";import"./index-DyhAhzq0.js";import"./index-Chjiymov.js";import"./CloseButton-C9u0iwLZ.js";import"./StatusIcon-f0e85OpL.js";import"./chainedFunction-BxZSneMW.js";import"./isNil-fn8XfVYM.js";import"./_baseIsEqual-CuZKDLrf.js";import"./_getPrototype-BUYMZDCV.js";const re=({searchTerm:n,filters:i})=>{const u=a.useRef(null),l=U(),[y,d]=a.useState([]),[C,o]=a.useState(!0),[m,w]=a.useState(1),[p,F]=a.useState(10),[K,$]=a.useState(0),[H,k]=a.useState(!1),[j,v]=a.useState(null),[W,D]=a.useState(!1),[I,J]=a.useState(null),[S,E]=a.useState("");a.useEffect(()=>{w(1)},[n,i]),a.useEffect(()=>{(async()=>{var s,r,B,O;o(!0);try{const f={page:m,limit:p,searchTerm:n||"",completed:!0};i.warranty!==void 0&&(f.warranty=i.warranty);const R=await c.get("https://mytest.hitechengineeringcompany.in/api/jobcards/",{params:f});d((r=(s=R.data)==null?void 0:s.data)==null?void 0:r.data),$((O=(B=R.data)==null?void 0:B.data)==null?void 0:O.countOfDocuments)}catch(f){console.error("Error fetching job cards:",f)}finally{o(!1)}})()},[m,p,n,i]);const q=t=>{v(t),k(!0)},x=()=>{k(!1),v(null)},A=t=>{J(t),D(!0)},N=()=>{D(!1),J(null),E("")},L=async()=>{var t,s;if(j)try{await c.put(`https://mytest.hitechengineeringcompany.in/api/jobcards/pending?id=${j}`);const r=await c.get("https://mytest.hitechengineeringcompany.in/api/jobcards/",{params:{page:m,limit:p,searchTerm:n,completed:!0}});d((s=(t=r.data)==null?void 0:t.data)==null?void 0:s.data),g.push(e.jsx(b,{title:"Success",type:"success",children:"Job card marked as pending successfully."})),x()}catch(r){console.error("Error marking job card as pending:",r)}},T=async()=>{var t,s;if(j)try{await c.put(`https://mytest.hitechengineeringcompany.in/api/jobcards/return?id=${j}`);const r=await c.get("https://mytest.hitechengineeringcompany.in/api/jobcards/",{params:{page:m,limit:p,searchTerm:n,completed:!0}});d((s=(t=r.data)==null?void 0:t.data)==null?void 0:s.data),g.push(e.jsx(b,{title:"Success",type:"success",children:"Job card marked as returned successfully."})),x()}catch(r){console.error("Error marking job card as returned:",r)}},_=async()=>{var t,s;if(!I||!S){g.push(e.jsx(b,{title:"Error",type:"danger",children:"Invoice number is required."}));return}try{await c.put(`https://mytest.hitechengineeringcompany.in/api/jobcards/bill?id=${I}&invoiceNumber=${S}`);const r=await c.get("https://mytest.hitechengineeringcompany.in/api/jobcards/",{params:{page:m,limit:p,searchTerm:n,completed:!0}});d((s=(t=r.data)==null?void 0:t.data)==null?void 0:s.data),g.push(e.jsx(b,{title:"Success",type:"success",children:"Job card billed successfully."})),N()}catch(r){console.error("Error billing job card:",r),g.push(e.jsx(b,{title:"Error",type:"danger",children:"Failed to bill job card. Please try again."}))}},M=a.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:t=>e.jsx("span",{className:"capitalize",children:t.row.original.customerName})},{header:"Phone",accessorKey:"phoneNumber"},{header:"Date",accessorKey:"InDate",cell:t=>e.jsx("span",{children:new Date(t.row.original.InDate).toLocaleDateString()})},{header:"Jobcard No.",accessorKey:"jobCardNumber"},{header:"Worker",accessorKey:"worker",cell:t=>{const s=t.row.original.worker;return s?e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.workerImage,alt:s.workerName,className:"w-10 h-10 rounded-full object-cover"})}):e.jsx("div",{className:"flex justify-center",children:e.jsx("span",{children:"-"})})}},{header:"Actions",id:"actions",cell:t=>e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>l(`/app/jobcards/jobcard/${t.row.original._id}`),children:e.jsx(X,{})}),e.jsx(h,{size:"xs",icon:e.jsx(Y,{}),onClick:()=>q(t.row.original._id),children:"Change"}),e.jsx(h,{size:"xs",icon:e.jsx(Z,{}),onClick:()=>A(t.row.original._id),children:"Bill"})]})}],[l]),G=t=>w(t),Q=t=>{F(t),w(1)};return e.jsxs(e.Fragment,{children:[e.jsx(te,{ref:u,columns:M,data:y,loading:C,pagingData:{total:K,pageIndex:m,pageSize:p},onPaginationChange:G,onSelectChange:Q}),e.jsx(P,{title:"Change Status",isOpen:H,onClose:x,onRequestClose:x,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{block:!0,onClick:L,children:"Pending"}),e.jsx(h,{block:!0,onClick:T,children:"Return"})]})}),e.jsx(P,{title:"Bill Job Card",isOpen:W,onClose:N,onRequestClose:N,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(z,{placeholder:"Enter Invoice Number",value:S,onChange:t=>E(t.target.value)}),e.jsx(h,{block:!0,onClick:_,children:"Submit"})]})})]})},ne=({onSearch:n,onFilter:i})=>{const[u,l]=a.useState(!1),y=se(o=>{n(o)},500),d=o=>{y(o.target.value)},C=o=>{l(o),i({warranty:o})};return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[e.jsx(z,{className:"w-full md:w-96 md:mb-0 mb-4",size:"sm",placeholder:"Search completed job cards...",prefix:e.jsx(ee,{className:"text-lg"}),onChange:d}),e.jsx("div",{className:"flex items-center",children:e.jsx(ae,{checked:u,onChange:C,children:"Warranty"})})]})},Pe=()=>{const[n,i]=a.useState(""),[u,l]=a.useState({});return e.jsxs(V,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Completed Job Cards"}),e.jsx(ne,{onSearch:i,onFilter:l})]}),e.jsx(re,{searchTerm:n,filters:u})]})};export{Pe as default};
