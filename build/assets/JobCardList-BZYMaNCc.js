import{r as t,a9 as B,j as e,ah as P}from"./index-DzuwMUJk.js";import{A as R}from"./AdaptableCard-BeBKmGTY.js";import{O as E,F as K,Y as L,Z as H,_ as T}from"./toString-wyiJ7teT.js";import{D as A}from"./DataTable-CT4zEuIH.js";import{B as M}from"./Badge-tWit_D0R.js";import{I as W}from"./Input-Brks8ori.js";import{B as g}from"./Button-wjgR3boE.js";import{D as _}from"./Drawer-DfVTzd_2.js";import{F as q,a as G,b as Q,c as k}from"./formik.esm-CMit2tkc.js";import{C as c}from"./index-DwclNWPp.js";import{d as U}from"./debounce-DIqprdcr.js";import{L as Y}from"./LinkButton-_rHWvnhq.js";import"./Card-zb4SO3fb.js";import"./Views-B7C5aCBY.js";import"./index-BAVH9xHy.js";import"./index-DEq-6zJ9.js";import"./Skeleton-BvSpIA5c.js";import"./Select-D4hXbUsF.js";import"./get-CYTsGD9q.js";import"./context-DYzOV7Yr.js";import"./index-CxIgI4X0.js";import"./isNil-fn8XfVYM.js";import"./useColorLevel-10S34ZEH.js";import"./index-DyhAhzq0.js";import"./index-Chjiymov.js";import"./CloseButton-C9u0iwLZ.js";import"./index-Blid5lza.js";import"./_baseIsEqual-CuZKDLrf.js";import"./_getPrototype-BUYMZDCV.js";const Z={Completed:{dotClass:"bg-emerald-500"},Pending:{dotClass:"bg-amber-500"},Cancelled:{dotClass:"bg-red-500"},Returned:{dotClass:"bg-blue-500"},Billed:{dotClass:"bg-purple-500"},Created:{dotClass:"bg-gray-500"}},$=({searchTerm:o,filters:r})=>{const d=t.useRef(null),i=B(),[j,f]=t.useState([]),[C,h]=t.useState(!0),[l,m]=t.useState(1),[a,x]=t.useState(10),[u,O]=t.useState(0);t.useEffect(()=>{m(1)},[o,r]),t.useEffect(()=>{(async()=>{var p,b,y,w,S,D,v,F;h(!0);try{const n={page:l,limit:a,searchTerm:o||""};r.warranty!==void 0&&(n.warranty=r.warranty),(p=r.status)!=null&&p.includes("Returned")&&(n.returned=!0),(b=r.status)!=null&&b.includes("Pending")&&(n.pending=!0),(y=r.status)!=null&&y.includes("Completed")&&(n.completed=!0),(w=r.status)!=null&&w.includes("Billed")&&(n.billed=!0);const N=await P.get("https://mytest.hitechengineeringcompany.in/api/jobcards/",{params:n});console.log(N),f((D=(S=N.data)==null?void 0:S.data)==null?void 0:D.data),O((F=(v=N.data)==null?void 0:v.data)==null?void 0:F.countOfDocuments)}catch(n){console.error("Error fetching job cards:",n)}finally{h(!1)}})()},[l,a,o,r]);const J=t.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:s=>e.jsx("span",{className:"capitalize",children:s.row.original.customerName})},{header:"Phone",accessorKey:"phoneNumber"},{header:"In-Date",accessorKey:"InDate",cell:s=>e.jsx("span",{children:new Date(s.row.original.InDate).toLocaleDateString()})},{header:"Out-Date",accessorKey:"OutDate",cell:s=>e.jsx("span",{children:s.row.original.OutDate?new Date(s.row.original.OutDate).toLocaleDateString():"-"})},{header:"Jobcard No.",accessorKey:"jobCardNumber"},{header:"Status",accessorKey:"jobCardStatus",cell:s=>{var b;const p=s.row.original.jobCardStatus;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:((b=Z[p])==null?void 0:b.dotClass)||"bg-gray-500"}),e.jsx("span",{className:"capitalize font-semibold",children:p})]})}},{header:"Actions",id:"actions",cell:s=>e.jsx("div",{className:"flex justify-end text-lg",children:e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>i(`/app/jobcards/jobcard/${s.row.original._id}`),children:e.jsx(E,{})})})}],[i]),z=s=>m(s),I=s=>{x(s),m(1)};return e.jsx(A,{ref:d,columns:J,data:j,loading:C,pagingData:{total:u,pageIndex:l,pageSize:a},onPaginationChange:z,onSelectChange:I})},V=({onSearch:o,onFilter:r})=>{const[d,i]=t.useState(!1),j=t.useRef(null),f=U(a=>{o(a)},500),C=a=>{f(a.target.value)},h=()=>i(!0),l=()=>i(!1),m=a=>{r({status:a.status.length>0?a.status:void 0,warranty:a.warranty??void 0}),l()};return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[e.jsx(W,{ref:j,className:"w-full md:w-96 md:mb-0 mb-4",size:"sm",placeholder:"Search job cards...",prefix:e.jsx(K,{className:"text-lg"}),onChange:C}),e.jsx(g,{size:"sm",className:"block lg:inline-block md:mb-0 mb-4",icon:e.jsx(L,{}),onClick:h,children:"Filter"}),e.jsx(g,{block:!0,size:"sm",icon:e.jsx(H,{}),className:"block lg:inline-block md:mb-0 mb-4",children:"Export"}),e.jsx(Y,{to:"/app/jobcards/jobcard-new",block:!0,variant:"solid",size:"sm",icon:e.jsx(T,{}),className:"block lg:inline-block md:mb-0 mb-4",children:"Add Job Card"}),e.jsx(_,{title:"Filter Job Cards",isOpen:d,onClose:l,onRequestClose:l,footer:e.jsxs("div",{className:"text-right w-full",children:[e.jsx(g,{size:"sm",className:"mr-2",onClick:l,children:"Cancel"}),e.jsx(g,{size:"sm",variant:"solid",type:"submit",form:"filter-form",children:"Query"})]}),children:e.jsx(q,{initialValues:{status:[],warranty:null},onSubmit:m,children:({values:a,setFieldValue:x})=>e.jsx(G,{id:"filter-form",children:e.jsxs(Q,{children:[e.jsxs(k,{children:[e.jsx("h6",{className:"mb-4",children:"Job Card Status"}),e.jsxs(c.Group,{vertical:!0,value:a.status,onChange:u=>x("status",u),children:[e.jsx(c,{className:"mb-3",value:"Pending",children:"Pending"}),e.jsx(c,{className:"mb-3",value:"Completed",children:"Completed"}),e.jsx(c,{className:"mb-3",value:"Returned",children:"Returned"}),e.jsx(c,{className:"mb-3",value:"Billed",children:"Billed"})]})]}),e.jsxs(k,{children:[e.jsx("h6",{className:"mb-4",children:"Warranty Status"}),e.jsx(c,{checked:a.warranty===!0,onChange:u=>x("warranty",u?!0:null),children:"Under Warranty"})]})]})})})})]})},ke=()=>{const[o,r]=t.useState(""),[d,i]=t.useState({});return e.jsxs(R,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Job Cards"}),e.jsx(V,{onSearch:r,onFilter:i})]}),e.jsx($,{searchTerm:o,filters:d})]})};export{ke as default};
