import{r as s,a9 as W,j as e,ah as z}from"./index-B7gDcve1.js";import{A as D}from"./AdaptableCard-DWDoig49.js";import{O as P,F as E,Y as I,Z as T,_ as A}from"./toString-BTJzyLo_.js";import{D as K}from"./DataTable-Bg1__MjQ.js";import{B as N}from"./Badge-C_F6d7pz.js";import{I as B}from"./Input-DDrsmMR1.js";import{B as f}from"./Button-CAnfWXiO.js";import{D as H}from"./Drawer-DB7Zv6KT.js";import{F as R,a as L,b as M,c as w}from"./formik.esm-Dw2xo4pZ.js";import{C as h}from"./index-CUuT-VC2.js";import{d as _}from"./debounce-C-swc0Qo.js";import{L as q}from"./LinkButton-DS8hYchV.js";import"./Card-ClSbbZpK.js";import"./Views-BimbbXt4.js";import"./index-BxaiHzCN.js";import"./index-BJgtahsK.js";import"./Skeleton-CipR6sCE.js";import"./Select-BdpL1eB2.js";import"./get-B7Jo_wI6.js";import"./context-Dj6ocMUM.js";import"./index-BzaCQqcK.js";import"./isNil-Bi4sFohX.js";import"./useColorLevel-10S34ZEH.js";import"./index-CuJy_WMJ.js";import"./index-Chjiymov.js";import"./CloseButton-CRM9zbV-.js";import"./index-N1U8ffo8.js";import"./_baseIsEqual-C86fEe5q.js";import"./_getPrototype-BDGNlnFu.js";const G={Pending:{dotClass:"bg-amber-500"},Closed:{dotClass:"bg-emerald-500"},"Sent to Workshop":{dotClass:"bg-blue-500"}},Q={Warranty:{dotClass:"bg-green-500"},"Non-Warranty":{dotClass:"bg-red-500"}},Y=({searchTerm:l,filters:r})=>{const d=s.useRef(null),c=W(),[b,S]=s.useState([]),[j,x]=s.useState(!0),[o,p]=s.useState(1),[t,g]=s.useState(10),[u,k]=s.useState(0);s.useEffect(()=>{p(1)},[l,r]),s.useEffect(()=>{(async()=>{var n,i,C;x(!0);try{const m={page:o,limit:t,searchTerm:l||""};r.warrantyStatus&&(m.warrantyStatus=r.warrantyStatus),(n=r.complaintStatus)!=null&&n.includes("Pending")&&(m.pending=!0),(i=r.complaintStatus)!=null&&i.includes("Closed")&&(m.closed=!0),(C=r.complaintStatus)!=null&&C.includes("Sent to Workshop")&&(m.sentToWorkshop=!0);const y=await z.get("https://mytest.hitechengineeringcompany.in/api/onsite",{params:m});S(y.data.data.data),k(y.data.data.countOfDocuments)}catch(m){console.error("Error fetching complaints:",m)}finally{x(!1)}})()},[o,t,l,r]);const v=s.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:a=>e.jsx("span",{className:"capitalize",children:a.row.original.customerName})},{header:"Address",accessorKey:"customerAddress"},{header:"Complaint No.",accessorKey:"complaintNumber"},{header:"Make",accessorKey:"make"},{header:"Warranty",accessorKey:"warrantyStatus",cell:a=>{var i;const n=a.row.original.warrantyStatus;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:((i=Q[n])==null?void 0:i.dotClass)||"bg-gray-500"}),e.jsx("span",{className:"capitalize font-semibold",children:n})]})}},{header:"Status",accessorKey:"complaintStatus",cell:a=>{var i;const n=a.row.original.complaintStatus;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:((i=G[n])==null?void 0:i.dotClass)||"bg-gray-500"}),e.jsx("span",{className:"capitalize font-semibold",children:n})]})}},{header:"Actions",id:"actions",cell:a=>e.jsx("div",{className:"flex justify-end text-lg",children:e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>c(`/app/onsite/${a.row.original._id}`),children:e.jsx(P,{})})})}],[c]),F=a=>p(a),O=a=>{g(a),p(1)};return e.jsx(K,{ref:d,columns:v,data:b,loading:j,pagingData:{total:u,pageIndex:o,pageSize:t},onPaginationChange:F,onSelectChange:O})},Z=({onSearch:l,onFilter:r})=>{const[d,c]=s.useState(!1),b=s.useRef(null),S=_(t=>{l(t)},500),j=t=>{S(t.target.value)},x=()=>c(!0),o=()=>c(!1),p=t=>{r({warrantyStatus:t.warrantyStatus||void 0,complaintStatus:t.complaintStatus.length>0?t.complaintStatus:void 0}),o()};return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[e.jsx(B,{ref:b,className:"w-full md:w-96 md:mb-0 mb-4",size:"sm",placeholder:"Search complaints...",prefix:e.jsx(E,{className:"text-lg"}),onChange:j}),e.jsx(f,{size:"sm",className:"block lg:inline-block md:mb-0 mb-4",icon:e.jsx(I,{}),onClick:x,children:"Filter"}),e.jsx(f,{block:!0,size:"sm",icon:e.jsx(T,{}),className:"block lg:inline-block md:mb-0 mb-4",children:"Export"}),e.jsx(q,{to:"/app/onsite/form",block:!0,variant:"solid",size:"sm",icon:e.jsx(A,{}),className:"block lg:inline-block md:mb-0 mb-4",children:"Add Complaint"}),e.jsx(H,{title:"Filter Complaints",isOpen:d,onClose:o,onRequestClose:o,footer:e.jsxs("div",{className:"text-right w-full",children:[e.jsx(f,{size:"sm",className:"mr-2",onClick:o,children:"Cancel"}),e.jsx(f,{size:"sm",variant:"solid",type:"submit",form:"filter-form",children:"Query"})]}),children:e.jsx(R,{initialValues:{complaintStatus:[],warrantyStatus:null},onSubmit:p,children:({values:t,setFieldValue:g})=>e.jsx(L,{id:"filter-form",children:e.jsxs(M,{children:[e.jsxs(w,{children:[e.jsx("h6",{className:"mb-4",children:"Complaint Status"}),e.jsxs(h.Group,{vertical:!0,value:t.complaintStatus,onChange:u=>g("complaintStatus",u),children:[e.jsx(h,{className:"mb-3",value:"Pending",children:"Pending"}),e.jsx(h,{className:"mb-3",value:"Closed",children:"Closed"}),e.jsx(h,{className:"mb-3",value:"Sent to Workshop",children:"Sent to Workshop"})]})]}),e.jsxs(w,{children:[e.jsx("h6",{className:"mb-4",children:"Warranty Status"}),e.jsx(h,{checked:t.warrantyStatus==="Warranty",onChange:u=>g("warrantyStatus",u?"Warranty":null),children:"Warranty"})]})]})})})})]})},we=()=>{const[l,r]=s.useState(""),[d,c]=s.useState({});return e.jsxs(D,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"On-Site Complaints"}),e.jsx(Z,{onSearch:r,onFilter:c})]}),e.jsx(Y,{searchTerm:l,filters:d})]})};export{we as default};
