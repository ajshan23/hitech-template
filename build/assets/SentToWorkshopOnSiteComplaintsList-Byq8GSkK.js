import{r as a,a9 as T,j as e,ah as u}from"./index-DzuwMUJk.js";import{A as E}from"./AdaptableCard-BeBKmGTY.js";import{O as I,a0 as K}from"./toString-wyiJ7teT.js";import{D as z}from"./DataTable-CT4zEuIH.js";import{B as A}from"./Badge-tWit_D0R.js";import{B as h}from"./Button-wjgR3boE.js";import{D as M}from"./Drawer-DfVTzd_2.js";import{P as R}from"./PendingOnSiteComplaintsTableTools-rok2puLu.js";import"./Card-zb4SO3fb.js";import"./Views-B7C5aCBY.js";import"./index-BAVH9xHy.js";import"./index-DEq-6zJ9.js";import"./Skeleton-BvSpIA5c.js";import"./Select-D4hXbUsF.js";import"./get-CYTsGD9q.js";import"./context-DYzOV7Yr.js";import"./index-DwclNWPp.js";import"./_baseIsEqual-CuZKDLrf.js";import"./_getPrototype-BUYMZDCV.js";import"./index-CxIgI4X0.js";import"./useColorLevel-10S34ZEH.js";import"./index-DyhAhzq0.js";import"./index-Chjiymov.js";import"./CloseButton-C9u0iwLZ.js";import"./Input-Brks8ori.js";import"./isNil-fn8XfVYM.js";import"./debounce-DIqprdcr.js";const B={Warranty:{dotClass:"bg-green-500"},"Non-Warranty":{dotClass:"bg-red-500"}},H=({searchTerm:o,warrantyFilter:n})=>{const m=a.useRef(null),i=T(),[j,g]=a.useState([]),[w,f]=a.useState(!0),[c,p]=a.useState(1),[l,N]=a.useState(10),[k,b]=a.useState(0),[D,S]=a.useState(!1),[x,y]=a.useState(null);a.useEffect(()=>{p(1)},[o,n]),a.useEffect(()=>{(async()=>{f(!0);try{const t={page:c,limit:l,searchTerm:o||"",complaintStatus:"Sent to Workshop"};n?t.warrantyStatus="true":t.warrantyStatus="false";const r=await u.get("https://mytest.hitechengineeringcompany.in/api/onsite",{params:t});g(r.data.data.data),b(r.data.data.countOfDocuments)}catch(t){console.error("Error fetching complaints:",t)}finally{f(!1)}})()},[c,l,o,n]);const O=s=>{y(s),S(!0)},d=()=>{S(!1),y(null)},C=async s=>{if(x)try{await u.put(`https://mytest.hitechengineeringcompany.in/api/onsite/${x}/status`,{complaintStatus:s});const t={page:c,limit:l,searchTerm:o||"",complaintStatus:"Sent to Workshop"};n?t.warrantyStatus="true":t.warrantyStatus="false";const r=await u.get("https://mytest.hitechengineeringcompany.in/api/onsite",{params:t});g(r.data.data.data),d()}catch(t){console.error("Error changing status:",t)}},W=a.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:s=>e.jsx("span",{className:"capitalize",children:s.row.original.customerName})},{header:"Address",accessorKey:"customerAddress"},{header:"Complaint No.",accessorKey:"complaintNumber"},{header:"Make",accessorKey:"make"},{header:"Warranty",accessorKey:"warrantyStatus",cell:s=>{var r;const t=s.row.original.warrantyStatus;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:((r=B[t])==null?void 0:r.dotClass)||"bg-gray-500"}),e.jsx("span",{className:"capitalize font-semibold",children:t})]})}},{header:"Worker",accessorKey:"attendedPerson",cell:s=>{const t=s.row.original.attendedPerson;return t?e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:t.workerImage,alt:t.workerName,className:"w-10 h-10 rounded-full object-cover"})}):null}},{header:"Actions",id:"actions",cell:s=>e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>i(`/app/onsite/${s.row.original._id}`),children:e.jsx(I,{})}),e.jsx(h,{size:"xs",icon:e.jsx(K,{}),onClick:()=>O(s.row.original._id),children:"Change Status"})]})}],[i]),v=s=>p(s),P=s=>{N(s),p(1)};return e.jsxs(e.Fragment,{children:[e.jsx(z,{ref:m,columns:W,data:j,loading:w,pagingData:{total:k,pageIndex:c,pageSize:l},onPaginationChange:v,onSelectChange:P}),e.jsx(M,{title:"Change Status",isOpen:D,onClose:d,onRequestClose:d,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{block:!0,onClick:()=>C("Pending"),children:"Mark as Pending"}),e.jsx(h,{block:!0,onClick:()=>C("Closed"),children:"Mark as Closed"})]})})]})},he=()=>{const[o,n]=a.useState(""),[m,i]=a.useState(!1);return e.jsxs(E,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Sent to Workshop On-Site Complaints"}),e.jsx(R,{onSearch:n,onFilter:i})]}),e.jsx(H,{searchTerm:o,warrantyFilter:m})]})};export{he as default};
