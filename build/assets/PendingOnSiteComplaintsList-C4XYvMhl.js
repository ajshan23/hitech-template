import{r as a,a9 as q,j as e,ah as i}from"./index-C2iY12u9.js";import{A as L}from"./AdaptableCard-BlvS43n3.js";import{P as F}from"./PendingOnSiteComplaintsTableTools-BV3D3geB.js";import{$ as U,O as G,a0 as J}from"./toString-DHyRyMxG.js";import{D as Q}from"./DataTable-BDP2abwy.js";import{B as V}from"./Badge-pgMGCxOU.js";import{B as m}from"./Button-D3qeit4v.js";import{D as v}from"./Drawer-BbgQ8DD9.js";import{t as D,N as O}from"./toast-B92lzaP4.js";import"./Card-BOIsTUCi.js";import"./Input-CF3VyKMy.js";import"./context-Cji_IDOW.js";import"./Views-DVTSfLY6.js";import"./isNil-DIAHqIoc.js";import"./get-C0nIbHDE.js";import"./index-CgfdXKrB.js";import"./_baseIsEqual-CfyzSPg-.js";import"./_getPrototype-3ogqeYEm.js";import"./debounce-BrVmJBvb.js";import"./index-ByEeNh7A.js";import"./index-D_PTICrA.js";import"./Skeleton-CmOtYc4u.js";import"./Select-DVojIqnk.js";import"./index-BP1Ivwmc.js";import"./useColorLevel-10S34ZEH.js";import"./index-DUhMXm8U.js";import"./index-Chjiymov.js";import"./CloseButton-CQqh2RdZ.js";import"./StatusIcon-zd0QlFoJ.js";import"./chainedFunction-BxZSneMW.js";const X={Warranty:{dotClass:"bg-green-500"},"Non-Warranty":{dotClass:"bg-red-500"}},Y=({searchTerm:n,warrantyFilter:o})=>{const p=a.useRef(null),d=q(),[P,u]=a.useState([]),[A,x]=a.useState(!0),[c,h]=a.useState(1),[l,W]=a.useState(10),[E,I]=a.useState(0),[z,y]=a.useState(!1),[S,j]=a.useState(null),[K,R]=a.useState([]),[T,C]=a.useState(!1),[w,N]=a.useState(null);a.useEffect(()=>{h(1)},[n,o]),a.useEffect(()=>{(async()=>{x(!0);try{const s={page:c,limit:l,searchTerm:n||"",complaintStatus:"Pending"};o?s.warrantyStatus="true":s.warrantyStatus="false";const r=await i.get("https://mytest.hitechengineeringcompany.in/api/onsite",{params:s});u(r.data.data.data),I(r.data.data.countOfDocuments)}catch(s){console.error("Error fetching complaints:",s)}finally{x(!1)}})()},[c,l,n,o]);const b=async t=>{j(t),y(!0);try{const s=await i.get("https://mytest.hitechengineeringcompany.in/api/worker/available");R(s.data.data)}catch(s){console.error("Error fetching available workers:",s)}},g=()=>{y(!1),j(null)},_=async t=>{if(S)try{await i.put(`https://mytest.hitechengineeringcompany.in/api/onsite/${S}/assign-worker`,{workerId:t});const s={page:c,limit:l,searchTerm:n||"",complaintStatus:"Pending"};o?s.warrantyStatus="true":s.warrantyStatus="false";const r=await i.get("https://mytest.hitechengineeringcompany.in/api/onsite",{params:s});u(r.data.data.data),g()}catch(s){console.error("Error assigning worker:",s)}},B=t=>{N(t),C(!0)},f=()=>{C(!1),N(null)},k=async t=>{if(w)try{await i.put(`https://mytest.hitechengineeringcompany.in/api/onsite/${w}/status`,{complaintStatus:t});const s={page:c,limit:l,searchTerm:n||"",complaintStatus:"Pending"};o?s.warrantyStatus="true":s.warrantyStatus="false";const r=await i.get("https://mytest.hitechengineeringcompany.in/api/onsite",{params:s});u(r.data.data.data),D.push(e.jsx(O,{title:"Success",type:"success",children:"Status changed successfully."})),f()}catch(s){console.error("Error changing status:",s),D.push(e.jsx(O,{title:"Error",type:"danger",children:"Failed to change status."}))}},$=a.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:t=>e.jsx("span",{className:"capitalize",children:t.row.original.customerName})},{header:"Address",accessorKey:"customerAddress"},{header:"Complaint No.",accessorKey:"complaintNumber"},{header:"Make",accessorKey:"make"},{header:"Warranty",accessorKey:"warrantyStatus",cell:t=>{var r;const s=t.row.original.warrantyStatus;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:((r=X[s])==null?void 0:r.dotClass)||"bg-gray-500"}),e.jsx("span",{className:"capitalize font-semibold",children:s})]})}},{header:"Worker",accessorKey:"attendedPerson",cell:t=>{const s=t.row.original.attendedPerson;return s?e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.workerImage,alt:s.workerName,className:"w-10 h-10 rounded-full object-cover cursor-pointer",onClick:()=>b(t.row.original._id)})}):e.jsx("div",{className:"flex justify-center",children:e.jsx(m,{size:"xs",icon:e.jsx(U,{}),onClick:()=>b(t.row.original._id),children:"Assign"})})}},{header:"Actions",id:"actions",cell:t=>e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>d(`/app/onsite/${t.row.original._id}`),children:e.jsx(G,{})}),e.jsx(m,{size:"xs",icon:e.jsx(J,{}),onClick:()=>B(t.row.original._id),children:"Change"})]})}],[d]),H=t=>h(t),M=t=>{W(t),h(1)};return e.jsxs(e.Fragment,{children:[e.jsx(Q,{ref:p,columns:$,data:P,loading:A,pagingData:{total:E,pageIndex:c,pageSize:l},onPaginationChange:H,onSelectChange:M}),e.jsx(v,{title:"Assign Worker",isOpen:z,onClose:g,onRequestClose:g,children:e.jsx("div",{className:"space-y-4",children:K.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-100 rounded",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:t.workerImage,alt:t.workerName,className:"w-10 h-10 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:t.workerName}),e.jsx("p",{className:"text-sm text-gray-500",children:t.phoneNumber})]})]}),e.jsx(m,{size:"xs",onClick:()=>_(t._id),children:"Assign"})]},t._id))})}),e.jsx(v,{title:"Change Status",isOpen:T,onClose:f,onRequestClose:f,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(m,{block:!0,onClick:()=>k("Closed"),children:"Close Complaint"}),e.jsx(m,{block:!0,onClick:()=>k("Sent to Workshop"),children:"Send to Workshop"})]})})]})},Pe=()=>{const[n,o]=a.useState(""),[p,d]=a.useState(!1);return e.jsxs(L,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Pending On-Site Complaints"}),e.jsx(F,{onSearch:o,onFilter:d})]}),e.jsx(Y,{searchTerm:n,warrantyFilter:p})]})};export{Pe as default};
