import{r as u,j as e,a9 as k,ai as S,ah as C}from"./index-B7gDcve1.js";import{u as v,c as m,d as l,F as A,a as F,b as q}from"./formik.esm-Dw2xo4pZ.js";import{B as j}from"./Button-CAnfWXiO.js";import{S as R}from"./StickyFooter-rSE1mHgZ.js";import{c as $,a as i,f as D}from"./index.esm-Vsnndpo-.js";import{t as x,N as g}from"./toast-Dkbl9R_F.js";import{A as w}from"./AdaptableCard-DWDoig49.js";import{I as h}from"./Input-DDrsmMR1.js";import"./Alert-D91OON6B.js";import"./index-TDdsVkA9.js";import"./Badge-C_F6d7pz.js";import"./index-BSF2ENXU.js";import"./Card-ClSbbZpK.js";import"./index-CUuT-VC2.js";import"./index-OFDI-AcE.js";import"./Dialog-DvUnFmtE.js";import"./Drawer-DB7Zv6KT.js";import"./index-Dd1eIuha.js";import"./useRootClose-C3rMHg9v.js";import"./index-C8TF9xIO.js";import"./index-Cex1eUOX.js";import"./Skeleton-CipR6sCE.js";import"./ScrollBar-6ZjQdx8v.js";import"./index-Cof0AvrT.js";import"./Select-BdpL1eB2.js";import"./index-BxaiHzCN.js";import"./Tag-CGWO6QIl.js";import"./useDidUpdate-67P_oJLh.js";import"./context-Dj6ocMUM.js";import"./index-N1U8ffo8.js";import"./Views-BimbbXt4.js";import"./get-B7Jo_wI6.js";import"./toString-BTJzyLo_.js";import"./useColorLevel-10S34ZEH.js";import"./StatusIcon-S-EimYFx.js";import"./CloseButton-CRM9zbV-.js";import"./chainedFunction-BxZSneMW.js";import"./isNil-Bi4sFohX.js";import"./useControllableState-Bg9-jDxW.js";import"./_baseIsEqual-C86fEe5q.js";import"./_getPrototype-BDGNlnFu.js";import"./index-CuJy_WMJ.js";import"./index-Chjiymov.js";import"./index-BJgtahsK.js";import"./index-BMxdz22E.js";const E=c=>{const{touched:n,errors:r,values:b}=c,{setFieldValue:d}=v(),t=u.useRef(null),y=b.phoneNumbers||[],f=(p,s)=>{if(p.key==="Enter"){p.preventDefault();{const o=document.querySelector(`[name="${s}"]`);o==null||o.focus()}}};return u.useEffect(()=>{t.current&&(t.current.style.height="auto",t.current.style.height=`${t.current.scrollHeight}px`)},[b.customerAddress]),e.jsxs(w,{divider:!0,className:"mb-4",children:[e.jsx("h5",{children:"Basic Information"}),e.jsx("p",{className:"mb-6",children:"Section to configure basic complaint details"}),e.jsx(m,{label:"Customer Name",invalid:!!r.customerName&&n.customerName,errorMessage:r.customerName,children:e.jsx(l,{type:"text",autoComplete:"off",name:"customerName",placeholder:"Customer Name",component:h,onKeyDown:p=>f(p,"customerAddress")})}),e.jsx(m,{label:"Customer Address",invalid:!!r.customerAddress&&n.customerAddress,errorMessage:r.customerAddress,children:e.jsx(l,{as:"textarea",name:"customerAddress",placeholder:"Customer Address",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:1,innerRef:t,style:{overflow:"hidden",resize:"none"}})}),e.jsx(m,{label:"Complaint Number",invalid:!!r.complaintNumber&&n.complaintNumber,errorMessage:r.complaintNumber,children:e.jsx(l,{type:"text",autoComplete:"off",name:"complaintNumber",placeholder:"Complaint Number",component:h})}),e.jsxs(m,{label:"Phone Numbers",invalid:!!r.phoneNumbers&&n.phoneNumbers,children:[y.map((p,s)=>e.jsx(l,{type:"text",autoComplete:"off",name:`phoneNumbers[${s}]`,placeholder:`Phone Number ${s+1}`,component:h,className:"mb-2"},s)),e.jsx(j,{size:"sm",type:"button",onClick:()=>d("phoneNumbers",[...y,""]),children:"Add Phone Number"})]})]})},M=c=>{const{touched:n,errors:r}=c;return e.jsxs(w,{divider:!0,className:"mb-4",children:[e.jsx("h5",{children:"Complaint Details"}),e.jsx("p",{className:"mb-6",children:"Section to configure complaint details"}),e.jsx(m,{label:"Make",invalid:!!r.make&&n.make,errorMessage:r.make,children:e.jsx(l,{type:"text",autoComplete:"off",name:"make",placeholder:"Make",component:h})}),e.jsx(m,{label:"Dealer Name",invalid:!!r.dealerName&&n.dealerName,errorMessage:r.dealerName,children:e.jsx(l,{type:"text",autoComplete:"off",name:"dealerName",placeholder:"Dealer Name",component:h})}),e.jsx(m,{label:"Warranty Status",invalid:!!r.warrantyStatus&&n.warrantyStatus,errorMessage:r.warrantyStatus,children:e.jsxs(l,{as:"select",name:"warrantyStatus",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Warranty Status"}),e.jsx("option",{value:"Warranty",children:"Warranty"}),e.jsx("option",{value:"Non-Warranty",children:"Non-Warranty"})]})}),e.jsx(m,{label:"Reported Complaint",invalid:!!r.reportedComplaint&&n.reportedComplaint,errorMessage:r.reportedComplaint,children:e.jsx(l,{as:"textarea",name:"reportedComplaint",placeholder:"Reported Complaint",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:3})})]})},I=$().shape({customerName:i().required("Customer Name is required"),customerAddress:i().required("Customer Address is required"),complaintNumber:i().required("Complaint Number is required"),phoneNumbers:D().of(i().required("Phone Number is required")).min(1,"At least one phone number is required"),make:i().required("Make is required"),dealerName:i().nullable(),warrantyStatus:i().required("Warranty Status is required"),reportedComplaint:i().required("Reported Complaint is required")}),P=u.forwardRef((c,n)=>{const{onDiscard:r}=c,b=k(),{id:d}=S(),t=d?"edit":"new",[y,f]=u.useState({customerName:"",customerAddress:"",complaintNumber:"",phoneNumbers:[],make:"",dealerName:"",warrantyStatus:"",reportedComplaint:""});u.useEffect(()=>{t==="edit"&&d&&(async()=>{try{const o=await C.get(`https://mytest.hitechengineeringcompany.in/api/onsite/${d}`);console.log("API Response:",o.data);const a=o.data.data;f({customerName:a.customerName,customerAddress:a.customerAddress,complaintNumber:a.complaintNumber,phoneNumbers:a.phoneNumbers||[],make:a.make,dealerName:a.dealerName,warrantyStatus:a.warrantyStatus,reportedComplaint:a.reportedComplaint})}catch(o){console.error("Error fetching complaint details:",o),x.push(e.jsx(g,{title:"Error",type:"danger",duration:2500,children:"Failed to fetch complaint details. Please try again."}),{placement:"top-center"})}})()},[d,t]);const p=async(s,{setSubmitting:o})=>{o(!0);try{const a=t==="new"?"https://mytest.hitechengineeringcompany.in/api/onsite":`https://mytest.hitechengineeringcompany.in/api/onsite/${d}`,N=t==="new"?"post":"put";if(console.log("Sending payload:",s),(await C[N](a,s)).status!==(t==="new"?201:200))throw new Error(`Failed to ${t==="new"?"create":"update"} complaint`);x.push(e.jsxs(g,{title:`Complaint ${t==="new"?"Created":"Updated"}`,type:"success",duration:2500,children:["Complaint ",t==="new"?"created":"updated"," successfully."]}),{placement:"top-center"}),b(-1)}catch(a){console.error(`Error ${t==="new"?"creating":"updating"} complaint:`,a),a.response&&console.error("API Response:",a.response.data),x.push(e.jsxs(g,{title:"Error",type:"danger",duration:2500,children:["Failed to ",t==="new"?"create":"update"," complaint. Please try again."]}),{placement:"top-center"})}finally{o(!1)}};return e.jsx(e.Fragment,{children:e.jsx(A,{innerRef:n,initialValues:y,validationSchema:I,onSubmit:p,enableReinitialize:!0,children:({values:s,touched:o,errors:a,isSubmitting:N})=>e.jsx(F,{children:e.jsxs(q,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(E,{touched:o,errors:a,values:s}),e.jsx(M,{touched:o,errors:a,values:s})]})}),e.jsxs(R,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:e.jsx(j,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:r,children:"Discard"})}),e.jsx("div",{className:"md:flex items-center",children:e.jsx(j,{size:"sm",variant:"solid",loading:N,type:"submit",children:t==="new"?"Create Complaint":"Update Complaint"})})]})]})})})})});P.displayName="OnSiteComplaintForm";export{P as default};
