import{r as b,j as e,a7 as R,ah as E,ai as M}from"./index-Bj3mz5Pw.js";import{u as D,c as y,d as m,F as q,a as S,b as P}from"./formik.esm-sXIm4dFv.js";import{B as w}from"./Button-Dhq_u3bq.js";import{S as $}from"./StickyFooter-BKNWh6Xy.js";import{c as T,a as u,e as j,f as N,b as z,g as J}from"./index.esm-DZfJtAA7.js";import{t as A,N as F}from"./toast-CEafV06e.js";import{A as v}from"./AdaptableCard-CW5rWfWy.js";import{I as C}from"./Input-9SAYI4Mj.js";import"./Alert-COxxIF6A.js";import"./index-Wjh0Y8Wg.js";import"./Badge-nyZZIW2G.js";import"./index-DRUN_WVw.js";import"./Card-vVKS0sxe.js";import"./index-C28Iij6M.js";import"./index-BkpwKNL5.js";import"./Dialog-BGMpSbig.js";import"./Drawer-7ZtkgvAT.js";import"./index-qV6DytUs.js";import"./useRootClose-DQLSAAfv.js";import"./index-B5ENYWct.js";import"./index-BLXFL4Zw.js";import"./Skeleton-DUNfQ8XH.js";import"./ScrollBar-CgXTrUgH.js";import"./index-C7QHI3ZB.js";import"./Select-bc2POzie.js";import"./index-DhcYxbh9.js";import"./Tag-Bgz3PWLK.js";import{U as K}from"./Upload-Dfm61XMO.js";import{J as V}from"./JobCardMachineDetailsFields-KkvJTTVp.js";import"./context-DBklxPP3.js";import"./index-DUqM6xV3.js";import"./Views-Bc58ZmG5.js";import"./get-CS1_jRFf.js";import"./toString-CQNPFSTv.js";import"./useColorLevel-10S34ZEH.js";import"./StatusIcon-sOt29h0g.js";import"./CloseButton-PxoRbE_t.js";import"./chainedFunction-BxZSneMW.js";import"./isNil-DFW_rJgM.js";import"./useControllableState-BOyOyjGi.js";import"./_baseIsEqual-WHXuIrZd.js";import"./_getPrototype-Dx9yexOq.js";import"./index-zI0RxmbS.js";import"./index-Chjiymov.js";import"./index-DereAiEi.js";import"./index-DUJXqaki.js";const B=k=>{const{touched:p,errors:l,values:t}=k,{setFieldValue:i}=D(),x=b.useRef(null),g=t.phoneNumbers||[],f=(d,s)=>{if(d.key==="Enter"){d.preventDefault();{const n=document.querySelector(`[name="${s}"]`);n==null||n.focus()}}};return b.useEffect(()=>{x.current&&(x.current.style.height="auto",x.current.style.height=`${x.current.scrollHeight}px`)},[t.customerAddress]),e.jsxs(v,{divider:!0,className:"mb-4",children:[e.jsx("h5",{children:"Customer Details"}),e.jsx("p",{className:"mb-6",children:"Section to configure customer information"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:"Fields marked with * are required"}),e.jsx(y,{label:"Customer Name *",invalid:!!l.customerName&&p.customerName,errorMessage:l.customerName,children:e.jsx(m,{type:"text",autoComplete:"off",name:"customerName",placeholder:"Customer Name",component:C,onKeyDown:d=>f(d,"customerAddress")})}),e.jsx(y,{label:"Customer Address *",invalid:!!l.customerAddress&&p.customerAddress,errorMessage:l.customerAddress,children:e.jsx(m,{as:"textarea",name:"customerAddress",placeholder:"Customer Address",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:1,innerRef:x,style:{overflow:"hidden",resize:"none"}})}),e.jsxs(y,{label:"Phone Numbers *",invalid:!!l.phoneNumbers&&p.phoneNumbers,children:[g.map((d,s)=>e.jsx(m,{type:"tel",autoComplete:"tel",name:`phoneNumbers[${s}]`,placeholder:`Phone Number ${s+1}`,component:C,className:"mb-2"},s)),e.jsx(w,{size:"sm",type:"button",onClick:()=>i("phoneNumbers",[...g,""]),children:"Add Phone Number"})]})]})},I=k=>{const{touched:p,errors:l}=k,{values:t,setFieldValue:i}=D(),x=b.useRef(null),g=b.useRef(null),f=b.useRef(null),d=b.useRef(null),s=(r,a)=>{if(r.key==="Enter"){if(r.shiftKey)return;if(r.preventDefault(),a){const o=document.querySelector(`[name="${a}"]`);o==null||o.focus()}}},n=r=>{r.current&&(r.current.style.height="auto",r.current.style.height=`${r.current.scrollHeight}px`)};return b.useEffect(()=>n(x),[t.works]),b.useEffect(()=>n(g),[t.spares]),b.useEffect(()=>n(f),[t.industrialworks]),b.useEffect(()=>n(d),[t.others]),e.jsxs(v,{divider:!0,className:"mb-4",children:[e.jsx("h5",{children:"Work Details"}),e.jsx("p",{className:"mb-6",children:"Section to configure work information"}),e.jsx(y,{label:"Works",invalid:!!l.works&&p.works,errorMessage:l.works,children:e.jsx(m,{as:"textarea",name:"works",placeholder:"Describe the works to be done",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:1,innerRef:x,onKeyDown:r=>s(r,"spares"),style:{overflow:"hidden",resize:"none"}})}),e.jsx(y,{label:"Spares",invalid:!!l.spares&&p.spares,errorMessage:l.spares,children:e.jsx(m,{as:"textarea",name:"spares",placeholder:"List the spares required",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:1,innerRef:g,onKeyDown:r=>s(r,"industrialworks"),style:{overflow:"hidden",resize:"none"}})}),e.jsx(y,{label:"Industrial Works",invalid:!!l.industrialworks&&p.industrialworks,errorMessage:l.industrialworks,children:e.jsx(m,{as:"textarea",name:"industrialworks",placeholder:"Describe any industrial works",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:1,innerRef:f,onKeyDown:r=>s(r,"others"),style:{overflow:"hidden",resize:"none"}})}),e.jsx(y,{label:"Others",invalid:!!l.others&&p.others,errorMessage:l.others,children:e.jsx(m,{as:"textarea",name:"others",placeholder:"Any other details",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:1,innerRef:d,onKeyDown:r=>s(r),style:{overflow:"hidden",resize:"none"}})}),e.jsx(y,{label:"Select Additional Fittings",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{type:"checkbox",id:"fan",name:"attachments",value:"fan",checked:t.attachments.includes("fan"),onChange:r=>{const{value:a,checked:o}=r.target,c=o?[...t.attachments,a]:t.attachments.filter(h=>h!==a);i("attachments",c)},className:"mr-2"}),e.jsx("label",{htmlFor:"fan",className:"text-gray-800 dark:text-white",children:"Fan"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{type:"checkbox",id:"fan_cover",name:"attachments",value:"fan cover",checked:t.attachments.includes("fan cover"),onChange:r=>{const{value:a,checked:o}=r.target,c=o?[...t.attachments,a]:t.attachments.filter(h=>h!==a);i("attachments",c)},className:"mr-2"}),e.jsx("label",{htmlFor:"fan_cover",className:"text-gray-800 dark:text-white",children:"Fan Cover"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{type:"checkbox",id:"terminal",name:"attachments",value:"terminal",checked:t.attachments.includes("terminal"),onChange:r=>{const{value:a,checked:o}=r.target,c=o?[...t.attachments,a]:t.attachments.filter(h=>h!==a);i("attachments",c)},className:"mr-2"}),e.jsx("label",{htmlFor:"terminal",className:"text-gray-800 dark:text-white",children:"Terminal"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{type:"checkbox",id:"terminal_box",name:"attachments",value:"terminal box",checked:t.attachments.includes("terminal box"),onChange:r=>{const{value:a,checked:o}=r.target,c=o?[...t.attachments,a]:t.attachments.filter(h=>h!==a);i("attachments",c)},className:"mr-2"}),e.jsx("label",{htmlFor:"terminal_box",className:"text-gray-800 dark:text-white",children:"Terminal Box"})]})]}),e.jsxs("div",{className:"flex flex-row gap-4 mt-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{type:"checkbox",id:"pulli",name:"attachments",value:"pulli",checked:t.attachments.includes("pulli"),onChange:r=>{const{value:a,checked:o}=r.target,c=o?[...t.attachments,a]:t.attachments.filter(h=>h!==a);i("attachments",c)},className:"mr-2"}),e.jsx("label",{htmlFor:"pulli",className:"text-gray-800 dark:text-white",children:"Pulli"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{type:"checkbox",id:"avr",name:"attachments",value:"AVR",checked:t.attachments.includes("AVR"),onChange:r=>{const{value:a,checked:o}=r.target,c=o?[...t.attachments,a]:t.attachments.filter(h=>h!==a);i("attachments",c)},className:"mr-2"}),e.jsx("label",{htmlFor:"avr",className:"text-gray-800 dark:text-white",children:"AVR"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{type:"checkbox",id:"diode",name:"attachments",value:"diode",checked:t.attachments.includes("diode"),onChange:r=>{const{value:a,checked:o}=r.target,c=o?[...t.attachments,a]:t.attachments.filter(h=>h!==a);i("attachments",c)},className:"mr-2"}),e.jsx("label",{htmlFor:"diode",className:"text-gray-800 dark:text-white",children:"Diode"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(m,{type:"checkbox",id:"grill",name:"attachments",value:"grill",checked:t.attachments.includes("grill"),onChange:r=>{const{value:a,checked:o}=r.target,c=o?[...t.attachments,a]:t.attachments.filter(h=>h!==a);i("attachments",c)},className:"mr-2"}),e.jsx("label",{htmlFor:"grill",className:"text-gray-800 dark:text-white",children:"Grill"})]})]})]})})]})},L=k=>{const p=(l,t)=>{if(!l||l.length===0)return"Please upload a file!";const i=l[0],x=i.type.startsWith("image/"),g=i.type==="application/pdf";return!x&&!g?"Please upload an image or PDF file!":i.size/1024/1024<=2?!0:"File size must be less than 2MB!"};return e.jsxs(v,{className:"mb-4",children:[e.jsx("h5",{children:"Job Card Files"}),e.jsx("p",{className:"mb-6",children:"Add or change files for the job card"}),e.jsx(y,{children:e.jsx(m,{name:"images",children:({field:l,form:t})=>e.jsx(K,{draggable:!0,beforeUpload:p,onChange:i=>{t.setFieldValue(l.name,i)},children:e.jsxs("div",{className:"my-16 text-center",children:[e.jsxs("p",{className:"font-semibold",children:[e.jsxs("span",{className:"text-gray-800 dark:text-white",children:["Drop your file here, or"," "]}),e.jsx("span",{className:"text-blue-500",children:"browse"})]}),e.jsx("p",{className:"mt-1 opacity-60 dark:text-white",children:"Support: jpeg, png, pdf"})]})})})})]})},W=T().shape({customerName:u().required("Customer Name is required"),customerAddress:u().required("Customer Address is required"),phoneNumbers:j().of(u().required("Phone Number is required")).min(1,"At least one phone number is required"),Make:u().required("Make is required"),HP:N().nullable(),KVA:N().nullable(),RPM:N().nullable(),Type:u().nullable(),Frame:u().nullable(),SrNo:u().nullable(),DealerName:u().nullable(),DealerNumber:u().nullable(),works:u().nullable(),spares:u().nullable(),industrialworks:u().nullable(),attachments:j().of(u()),warranty:z().nullable(),others:u().nullable(),images:j().of(J())}),_=b.forwardRef((k,p)=>{const{type:l,onDiscard:t}=k,i=R(),x={customerName:"",customerAddress:"",phoneNumbers:[""],Make:"",HP:void 0,KVA:void 0,RPM:void 0,Type:"",Frame:"",SrNo:"",DealerName:"",DealerNumber:"",works:"",spares:"",industrialworks:"",attachments:[],warranty:!1,others:"",images:[]},g=async(f,{setSubmitting:d})=>{d(!0);const s=new FormData;Object.keys(f).forEach(n=>{const r=f[n];if(n==="attachments"&&Array.isArray(r))r.forEach(a=>{s.append("attachments",a)});else if(n==="images"&&Array.isArray(r))r.forEach(a=>{s.append("files",a)});else if(n==="phoneNumbers"){const a=typeof r=="string"?r.split(","):Array.isArray(r)?r:[];a.length>0&&a.forEach((o,c)=>{s.append(`phoneNumbers[${c}]`,o)})}else r!=null&&s.append(n,r.toString())});try{if((await E.post(`${M}/jobcards`,s,{headers:{"Content-Type":"multipart/form-data"}})).status!==201)throw new Error("Failed to create job card");A.push(e.jsx(F,{title:"Job Card Created",type:"success",duration:2500,children:"Job Card created successfully."}),{placement:"top-center"}),i("/sales/jobcard-list")}catch(n){console.error("Error creating job card:",n),A.push(e.jsx(F,{title:"Error",type:"danger",duration:2500,children:"Failed to create job card. Please try again."}),{placement:"top-center"})}finally{d(!1)}};return e.jsx(e.Fragment,{children:e.jsx(q,{innerRef:p,initialValues:x,validationSchema:W,onSubmit:g,children:({values:f,touched:d,errors:s,isSubmitting:n})=>((s.customerName||s.customerAddress||s.phoneNumbers||s.Make)&&Object.keys(d).length>0&&window.scrollTo({top:0,behavior:"smooth"}),e.jsx(S,{children:e.jsxs(P,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(B,{touched:d,errors:s,values:f}),e.jsx(V,{touched:d,errors:s,values:f}),e.jsx(I,{touched:d,errors:s})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(L,{values:{images:f.images}})})]}),e.jsxs($,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:e.jsx(w,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:t,children:"Discard"})}),e.jsx("div",{className:"md:flex items-center",children:e.jsx(w,{size:"sm",variant:"solid",loading:n,type:"submit",children:"Create Job Card"})})]})]})}))})})});_.displayName="JobCardForm";export{_ as default};
