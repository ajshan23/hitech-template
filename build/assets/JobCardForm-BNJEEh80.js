import{r as p,j as e,a9 as A,ah as D}from"./index-C2iY12u9.js";import{u as R,c as b,d as h,F as E,a as S,b as J}from"./formik.esm-ArP3_adF.js";import{B as w}from"./Button-D3qeit4v.js";import{S as K}from"./StickyFooter-Cyqjpfke.js";import{c as T,a as d,e as j,f as N,b as z,g as M}from"./index.esm-7-xCUnXA.js";import{t as v,N as F}from"./toast-B92lzaP4.js";import{J as P,a as $}from"./JobCardMachineDetailsFields-CsT7XF7B.js";import{A as C}from"./AdaptableCard-BlvS43n3.js";import{U as q}from"./useDidUpdate-Cfkr9bLD.js";import"./Alert-BUCnMLNe.js";import"./index-BugQn9pU.js";import"./Badge-pgMGCxOU.js";import"./index-BdWTLzCH.js";import"./Card-BOIsTUCi.js";import"./index-CgfdXKrB.js";import"./index-n4AhYPz9.js";import"./Dialog-dSu66xmJ.js";import"./Drawer-BbgQ8DD9.js";import"./index-Dq2v8-oy.js";import"./useRootClose-CBf41JAC.js";import"./Input-CF3VyKMy.js";import"./index-BEn5L5k6.js";import"./index-DAy840b7.js";import"./Skeleton-CmOtYc4u.js";import"./ScrollBar-fS8lh1Wz.js";import"./index-CIR-zfpl.js";import"./Select-DVojIqnk.js";import"./index-ByEeNh7A.js";import"./Tag-CPjWtCnv.js";import"./context-Cji_IDOW.js";import"./index-pusp267n.js";import"./Views-DVTSfLY6.js";import"./get-C0nIbHDE.js";import"./toString-DHyRyMxG.js";import"./useColorLevel-10S34ZEH.js";import"./StatusIcon-zd0QlFoJ.js";import"./CloseButton-CQqh2RdZ.js";import"./chainedFunction-BxZSneMW.js";import"./_baseIsEqual-CfyzSPg-.js";import"./_getPrototype-3ogqeYEm.js";import"./index-3FLpAjPU.js";import"./useControllableState-CSGbWlWY.js";import"./index-DUhMXm8U.js";import"./index-Chjiymov.js";import"./isNil-DIAHqIoc.js";import"./index-D_PTICrA.js";const I=y=>{const{touched:x,errors:l}=y,{values:t,setFieldValue:n}=R(),g=p.useRef(null),k=p.useRef(null),f=p.useRef(null),u=p.useRef(null),m=(a,r)=>{if(a.key==="Enter"){if(a.shiftKey)return;if(a.preventDefault(),r){const s=document.querySelector(`[name="${r}"]`);s==null||s.focus()}}},c=a=>{a.current&&(a.current.style.height="auto",a.current.style.height=`${a.current.scrollHeight}px`)};return p.useEffect(()=>c(g),[t.works]),p.useEffect(()=>c(k),[t.spares]),p.useEffect(()=>c(f),[t.industrialworks]),p.useEffect(()=>c(u),[t.others]),e.jsxs(C,{divider:!0,className:"mb-4",children:[e.jsx("h5",{children:"Work Details"}),e.jsx("p",{className:"mb-6",children:"Section to configure work information"}),e.jsx(b,{label:"Works",invalid:!!l.works&&x.works,errorMessage:l.works,children:e.jsx(h,{as:"textarea",name:"works",placeholder:"Describe the works to be done",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:1,innerRef:g,onKeyDown:a=>m(a,"spares"),style:{overflow:"hidden",resize:"none"}})}),e.jsx(b,{label:"Spares",invalid:!!l.spares&&x.spares,errorMessage:l.spares,children:e.jsx(h,{as:"textarea",name:"spares",placeholder:"List the spares required",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:1,innerRef:k,onKeyDown:a=>m(a,"industrialworks"),style:{overflow:"hidden",resize:"none"}})}),e.jsx(b,{label:"Industrial Works",invalid:!!l.industrialworks&&x.industrialworks,errorMessage:l.industrialworks,children:e.jsx(h,{as:"textarea",name:"industrialworks",placeholder:"Describe any industrial works",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:1,innerRef:f,onKeyDown:a=>m(a,"others"),style:{overflow:"hidden",resize:"none"}})}),e.jsx(b,{label:"Others",invalid:!!l.others&&x.others,errorMessage:l.others,children:e.jsx(h,{as:"textarea",name:"others",placeholder:"Any other details",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:1,innerRef:u,onKeyDown:a=>m(a),style:{overflow:"hidden",resize:"none"}})}),e.jsx(b,{label:"Select Additional Fittings",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{type:"checkbox",id:"fan",name:"attachments",value:"fan",checked:t.attachments.includes("fan"),onChange:a=>{const{value:r,checked:s}=a.target,o=s?[...t.attachments,r]:t.attachments.filter(i=>i!==r);n("attachments",o)},className:"mr-2"}),e.jsx("label",{htmlFor:"fan",className:"text-gray-800 dark:text-white",children:"Fan"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{type:"checkbox",id:"fan_cover",name:"attachments",value:"fan cover",checked:t.attachments.includes("fan cover"),onChange:a=>{const{value:r,checked:s}=a.target,o=s?[...t.attachments,r]:t.attachments.filter(i=>i!==r);n("attachments",o)},className:"mr-2"}),e.jsx("label",{htmlFor:"fan_cover",className:"text-gray-800 dark:text-white",children:"Fan Cover"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{type:"checkbox",id:"terminal",name:"attachments",value:"terminal",checked:t.attachments.includes("terminal"),onChange:a=>{const{value:r,checked:s}=a.target,o=s?[...t.attachments,r]:t.attachments.filter(i=>i!==r);n("attachments",o)},className:"mr-2"}),e.jsx("label",{htmlFor:"terminal",className:"text-gray-800 dark:text-white",children:"Terminal"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{type:"checkbox",id:"terminal_box",name:"attachments",value:"terminal box",checked:t.attachments.includes("terminal box"),onChange:a=>{const{value:r,checked:s}=a.target,o=s?[...t.attachments,r]:t.attachments.filter(i=>i!==r);n("attachments",o)},className:"mr-2"}),e.jsx("label",{htmlFor:"terminal_box",className:"text-gray-800 dark:text-white",children:"Terminal Box"})]})]}),e.jsxs("div",{className:"flex flex-row gap-4 mt-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{type:"checkbox",id:"pulli",name:"attachments",value:"pulli",checked:t.attachments.includes("pulli"),onChange:a=>{const{value:r,checked:s}=a.target,o=s?[...t.attachments,r]:t.attachments.filter(i=>i!==r);n("attachments",o)},className:"mr-2"}),e.jsx("label",{htmlFor:"pulli",className:"text-gray-800 dark:text-white",children:"Pulli"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{type:"checkbox",id:"avr",name:"attachments",value:"AVR",checked:t.attachments.includes("AVR"),onChange:a=>{const{value:r,checked:s}=a.target,o=s?[...t.attachments,r]:t.attachments.filter(i=>i!==r);n("attachments",o)},className:"mr-2"}),e.jsx("label",{htmlFor:"avr",className:"text-gray-800 dark:text-white",children:"AVR"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{type:"checkbox",id:"diode",name:"attachments",value:"diode",checked:t.attachments.includes("diode"),onChange:a=>{const{value:r,checked:s}=a.target,o=s?[...t.attachments,r]:t.attachments.filter(i=>i!==r);n("attachments",o)},className:"mr-2"}),e.jsx("label",{htmlFor:"diode",className:"text-gray-800 dark:text-white",children:"Diode"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{type:"checkbox",id:"grill",name:"attachments",value:"grill",checked:t.attachments.includes("grill"),onChange:a=>{const{value:r,checked:s}=a.target,o=s?[...t.attachments,r]:t.attachments.filter(i=>i!==r);n("attachments",o)},className:"mr-2"}),e.jsx("label",{htmlFor:"grill",className:"text-gray-800 dark:text-white",children:"Grill"})]})]})]})})]})},V=y=>{const x=(l,t)=>{if(!l||l.length===0)return"Please upload an image file!";const n=l[0];return n.type.startsWith("image/")?n.size/1024<=500?!0:"Image size must be less than 500KB!":"Please upload an image file!"};return e.jsxs(C,{className:"mb-4",children:[e.jsx("h5",{children:"Job Card Images"}),e.jsx("p",{className:"mb-6",children:"Add or change images for the job card"}),e.jsx(b,{children:e.jsx(h,{name:"images",children:({field:l,form:t})=>e.jsx(q,{draggable:!0,beforeUpload:x,onChange:n=>t.setFieldValue(l.name,n),children:e.jsxs("div",{className:"my-16 text-center",children:[e.jsxs("p",{className:"font-semibold",children:[e.jsxs("span",{className:"text-gray-800 dark:text-white",children:["Drop your image here, or"," "]}),e.jsx("span",{className:"text-blue-500",children:"browse"})]}),e.jsx("p",{className:"mt-1 opacity-60 dark:text-white",children:"Support: jpeg, png"})]})})})})]})},B=T().shape({customerName:d().required("Customer Name is required"),customerAddress:d().required("Customer Address is required"),phoneNumber:d().required("Phone Number is required"),Make:d().nullable(),HP:j().nullable(),KVA:j().nullable(),RPM:j().nullable(),Type:d().nullable(),Frame:d().nullable(),SrNo:d().nullable(),DealerName:d().nullable(),DealerNumber:d().nullable(),works:d().nullable(),spares:d().nullable(),industrialworks:d().nullable(),attachments:N().of(d()),warranty:z(),others:d().nullable(),images:N().of(M())}),W=p.forwardRef((y,x)=>{const{type:l,onDiscard:t}=y,n=A(),g={customerName:"",customerAddress:"",phoneNumber:"",Make:"",HP:void 0,KVA:void 0,RPM:void 0,Type:"",Frame:"",SrNo:"",DealerName:"",DealerNumber:"",works:"",spares:"",industrialworks:"",attachments:[],warranty:!1,others:"",images:[]},k=async(f,{setSubmitting:u})=>{u(!0);const m=new FormData;Object.keys(f).forEach(c=>{const a=f[c];c==="attachments"&&Array.isArray(a)?a.forEach((r,s)=>{m.append(`attachments[${s}]`,r)}):c==="images"&&Array.isArray(a)?a.forEach(r=>{m.append("images",r)}):a!=null&&m.append(c,a.toString())});try{if((await D.post("https://mytest.hitechengineeringcompany.in/api/jobcards",m,{headers:{"Content-Type":"multipart/form-data"}})).status!==201)throw new Error("Failed to create job card");v.push(e.jsx(F,{title:"Job Card Created",type:"success",duration:2500,children:"Job Card created successfully."}),{placement:"top-center"}),n("/sales/jobcard-list")}catch(c){console.error("Error creating job card:",c),v.push(e.jsx(F,{title:"Error",type:"danger",duration:2500,children:"Failed to create job card. Please try again."}),{placement:"top-center"})}finally{u(!1)}};return e.jsx(e.Fragment,{children:e.jsx(E,{innerRef:x,initialValues:g,validationSchema:B,onSubmit:k,children:({values:f,touched:u,errors:m,isSubmitting:c})=>e.jsx(S,{children:e.jsxs(J,{children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(P,{touched:u,errors:m}),e.jsx($,{touched:u,errors:m,values:f}),e.jsx(I,{touched:u,errors:m})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(V,{values:{images:f.images}})})]}),e.jsxs(K,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:e.jsx(w,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:t,children:"Discard"})}),e.jsx("div",{className:"md:flex items-center",children:e.jsx(w,{size:"sm",variant:"solid",loading:c,type:"submit",children:"Create Job Card"})})]})]})})})})});W.displayName="JobCardForm";export{W as default};
