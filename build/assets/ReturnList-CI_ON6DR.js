import{r as a,a9 as A,j as e,ah as u}from"./index-B7gDcve1.js";import{A as H}from"./AdaptableCard-DWDoig49.js";import{O as L,a0 as T,F as $}from"./toString-BTJzyLo_.js";import{D as B}from"./DataTable-Bg1__MjQ.js";import{B as y}from"./Button-CAnfWXiO.js";import{D as _}from"./Drawer-DB7Zv6KT.js";import{t as D,N as v}from"./toast-Dkbl9R_F.js";import{I as q}from"./Input-DDrsmMR1.js";import{C as M}from"./index-CUuT-VC2.js";import{d as G}from"./debounce-C-swc0Qo.js";import"./Card-ClSbbZpK.js";import"./Views-BimbbXt4.js";import"./index-BxaiHzCN.js";import"./index-BJgtahsK.js";import"./Skeleton-CipR6sCE.js";import"./Select-BdpL1eB2.js";import"./get-B7Jo_wI6.js";import"./context-Dj6ocMUM.js";import"./index-BzaCQqcK.js";import"./useColorLevel-10S34ZEH.js";import"./index-CuJy_WMJ.js";import"./index-Chjiymov.js";import"./CloseButton-CRM9zbV-.js";import"./StatusIcon-S-EimYFx.js";import"./chainedFunction-BxZSneMW.js";import"./isNil-Bi4sFohX.js";import"./_baseIsEqual-C86fEe5q.js";import"./_getPrototype-BDGNlnFu.js";const Q=({searchTerm:r,filters:c})=>{const l=a.useRef(null),i=A(),[f,d]=a.useState([]),[j,n]=a.useState(!0),[m,b]=a.useState(1),[p,J]=a.useState(10),[I,R]=a.useState(0),[E,w]=a.useState(!1),[h,C]=a.useState(null);a.useEffect(()=>{b(1)},[r,c]),a.useEffect(()=>{(async()=>{var s,o,S,N;n(!0);try{const x={page:m,limit:p,searchTerm:r||"",returned:!0};c.warranty!==void 0&&(x.warranty=c.warranty);const k=await u.get("https://mytest.hitechengineeringcompany.in/api/jobcards/",{params:x});d((o=(s=k.data)==null?void 0:s.data)==null?void 0:o.data),R((N=(S=k.data)==null?void 0:S.data)==null?void 0:N.countOfDocuments)}catch(x){console.error("Error fetching job cards:",x)}finally{n(!1)}})()},[m,p,r,c]);const O=t=>{C(t),w(!0)},g=()=>{w(!1),C(null)},P=async()=>{var t,s;if(h)try{await u.put(`https://mytest.hitechengineeringcompany.in/api/jobcards/pending?id=${h}`);const o=await u.get("https://mytest.hitechengineeringcompany.in/api/jobcards/",{params:{page:m,limit:p,searchTerm:r,returned:!0}});d((s=(t=o.data)==null?void 0:t.data)==null?void 0:s.data),D.push(e.jsx(v,{title:"Success",type:"success",children:"Job card marked as pending successfully."})),g()}catch(o){console.error("Error marking job card as pending:",o)}},z=async()=>{var t,s;if(h)try{await u.put(`https://mytest.hitechengineeringcompany.in/api/jobcards/work-done?id=${h}`);const o=await u.get("https://mytest.hitechengineeringcompany.in/api/jobcards/",{params:{page:m,limit:p,searchTerm:r,returned:!0}});d((s=(t=o.data)==null?void 0:t.data)==null?void 0:s.data),D.push(e.jsx(v,{title:"Success",type:"success",children:"Job card marked as completed successfully."})),g()}catch(o){console.error("Error marking job card as completed:",o)}},F=a.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:t=>e.jsx("span",{className:"capitalize",children:t.row.original.customerName})},{header:"Phone",accessorKey:"phoneNumber"},{header:"Date",accessorKey:"InDate",cell:t=>e.jsx("span",{children:new Date(t.row.original.InDate).toLocaleDateString()})},{header:"Jobcard No.",accessorKey:"jobCardNumber"},{header:"Worker",accessorKey:"worker",cell:t=>{const s=t.row.original.worker;return s?e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.workerImage,alt:s.workerName,className:"w-10 h-10 rounded-full object-cover"})}):e.jsx("div",{className:"flex justify-center",children:e.jsx("span",{children:"-"})})}},{header:"Actions",id:"actions",cell:t=>e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>i(`/app/jobcards/jobcard/${t.row.original._id}`),children:e.jsx(L,{})}),e.jsx(y,{size:"xs",icon:e.jsx(T,{}),onClick:()=>O(t.row.original._id),children:"Change"})]})}],[i]),K=t=>b(t),W=t=>{J(t),b(1)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{ref:l,columns:F,data:f,loading:j,pagingData:{total:I,pageIndex:m,pageSize:p},onPaginationChange:K,onSelectChange:W}),e.jsx(_,{title:"Change Status",isOpen:E,onClose:g,onRequestClose:g,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{block:!0,onClick:P,children:"Pending"}),e.jsx(y,{block:!0,onClick:z,children:"Completed"})]})})]})},U=({onSearch:r,onFilter:c})=>{const[l,i]=a.useState(!1),f=G(n=>{r(n)},500),d=n=>{f(n.target.value)},j=n=>{i(n),c({warranty:n})};return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[e.jsx(q,{className:"w-full md:w-96 md:mb-0 mb-4",size:"sm",placeholder:"Search returned job cards...",prefix:e.jsx($,{className:"text-lg"}),onChange:d}),e.jsx("div",{className:"flex items-center",children:e.jsx(M,{checked:l,onChange:j,children:"Warranty"})})]})},Ne=()=>{const[r,c]=a.useState(""),[l,i]=a.useState({});return e.jsxs(H,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Returned Job Cards"}),e.jsx(U,{onSearch:c,onFilter:i})]}),e.jsx(Q,{searchTerm:r,filters:l})]})};export{Ne as default};
