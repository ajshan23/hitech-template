import{r as a,a7 as T,j as e,ah as u,ai as h}from"./index-BM13tXlW.js";import{A as I}from"./AdaptableCard-S0V3F3D9.js";import{I as A,Y as K}from"./toString-DsRmm2zR.js";import{D as R}from"./debounce-C9E5GhhN.js";import{B as z}from"./Badge-CjbLqAKu.js";import{B as g}from"./Button-mPLf3e2P.js";import{D as B}from"./Drawer-BVIdsEV9.js";import{P as M}from"./PendingOnSiteComplaintsTableTools-FrmrNds4.js";import"./Card-Bu1MVQSg.js";import"./Views-C55FHhfo.js";import"./index-Co_XQlG1.js";import"./index-C2uHdBR5.js";import"./Skeleton-CiBPwE_V.js";import"./Select-wVU8qQSS.js";import"./get-DaIh6SQK.js";import"./context-BsDA0hJO.js";import"./index-D7naHzVB.js";import"./_baseIsEqual-C6NqMIho.js";import"./_getPrototype-Cl_NgycI.js";import"./index-C6zHQZFb.js";import"./useColorLevel-10S34ZEH.js";import"./index-NXaP3oL6.js";import"./index-Chjiymov.js";import"./CloseButton-BQ2-rMGt.js";import"./Input-BDyFHEHH.js";import"./isNil-Da3VpJ5R.js";const $={Warranty:{dotClass:"bg-green-500"},"Non-Warranty":{dotClass:"bg-red-500"}},L=({searchTerm:o,warrantyFilter:n})=>{const m=a.useRef(null),i=T(),[w,S]=a.useState([]),[N,f]=a.useState(!0),[l,p]=a.useState(1),[c,k]=a.useState(10),[b,D]=a.useState(0),[W,x]=a.useState(!1),[C,j]=a.useState(null);a.useEffect(()=>{p(1)},[o,n]),a.useEffect(()=>{(async()=>{f(!0);try{const t={page:l,limit:c,searchTerm:o||"",complaintStatus:"Sent to Workshop"};n?t.warrantyStatus="true":t.warrantyStatus="false";const r=await u.get(`${h}/onsite`,{params:t});S(r.data.data.data),D(r.data.data.countOfDocuments)}catch(t){console.error("Error fetching complaints:",t)}finally{f(!1)}})()},[l,c,o,n]);const v=s=>{j(s),x(!0)},d=()=>{x(!1),j(null)},y=async s=>{if(C)try{await u.put(`${h}/onsite/${C}/status`,{complaintStatus:s});const t={page:l,limit:c,searchTerm:o||"",complaintStatus:"Sent to Workshop"};n?t.warrantyStatus="true":t.warrantyStatus="false";const r=await u.get(`${h}/onsite`,{params:t});S(r.data.data.data),d()}catch(t){console.error("Error changing status:",t)}},O=a.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:s=>e.jsx("span",{className:"capitalize",children:s.row.original.customerName})},{header:"Address",accessorKey:"customerAddress"},{header:"Complaint No.",accessorKey:"complaintNumber"},{header:"Make",accessorKey:"make"},{header:"Warranty",accessorKey:"warrantyStatus",cell:s=>{var r;const t=s.row.original.warrantyStatus;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:((r=$[t])==null?void 0:r.dotClass)||"bg-gray-500"}),e.jsx("span",{className:"capitalize font-semibold",children:t})]})}},{header:"Worker",accessorKey:"attendedPerson",cell:s=>{const t=s.row.original.attendedPerson;return t?e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:t.workerImage,alt:t.workerName,className:"w-10 h-10 rounded-full object-cover"})}):null}},{header:"Actions",id:"actions",cell:s=>e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>i(`/app/onsite/${s.row.original._id}`),children:e.jsx(A,{})}),e.jsx(g,{size:"xs",icon:e.jsx(K,{}),onClick:()=>v(s.row.original._id),children:"Change Status"})]})}],[i]),P=s=>p(s),E=s=>{k(s),p(1)};return e.jsxs(e.Fragment,{children:[e.jsx(R,{ref:m,columns:O,data:w,loading:N,pagingData:{total:b,pageIndex:l,pageSize:c},onPaginationChange:P,onSelectChange:E}),e.jsx(B,{title:"Change Status",isOpen:W,onClose:d,onRequestClose:d,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{block:!0,onClick:()=>y("Pending"),children:"Mark as Pending"}),e.jsx(g,{block:!0,onClick:()=>y("Closed"),children:"Mark as Closed"})]})})]})},he=()=>{const[o,n]=a.useState(""),[m,i]=a.useState(!1);return e.jsxs(I,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Sent to Workshop On-Site Complaints"}),e.jsx(M,{onSearch:n,onFilter:i})]}),e.jsx(L,{searchTerm:o,warrantyFilter:m})]})};export{he as default};
