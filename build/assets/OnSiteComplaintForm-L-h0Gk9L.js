import{r as u,j as e,a7 as S,aj as v,ah as w,ai as y}from"./index-BM13tXlW.js";import{u as A,c as l,d as m,F,a as $,b as R}from"./formik.esm-CjXDcxR1.js";import{B as C}from"./Button-mPLf3e2P.js";import{S as D}from"./StickyFooter-B1QkQ1Sw.js";import{c as E,a as i,e as I}from"./index.esm-CsHsAGHu.js";import{t as g,N as j}from"./toast-Du1XL2BS.js";import{A as k}from"./AdaptableCard-S0V3F3D9.js";import{I as h}from"./Input-BDyFHEHH.js";import"./Alert-CmxhFRv7.js";import"./index-Bqch-tRy.js";import"./Badge-CjbLqAKu.js";import"./index-cpvdiBaZ.js";import"./Card-Bu1MVQSg.js";import"./index-D7naHzVB.js";import"./index-vCm1pUfs.js";import"./Dialog-BrvweEo1.js";import"./Drawer-BVIdsEV9.js";import"./index-CmGk0WUA.js";import"./useRootClose-D1KFPgnL.js";import"./index-BjiutrA3.js";import"./index-Cxm45JOp.js";import"./Skeleton-CiBPwE_V.js";import"./ScrollBar-D0FgHD4H.js";import"./index-CgKH22AO.js";import"./Select-wVU8qQSS.js";import"./index-Co_XQlG1.js";import"./Tag-h1QHZ3MK.js";import"./Upload-D0HX0Acz.js";import"./context-BsDA0hJO.js";import"./index-DjY4Mmwk.js";import"./Views-C55FHhfo.js";import"./get-DaIh6SQK.js";import"./toString-DsRmm2zR.js";import"./useColorLevel-10S34ZEH.js";import"./StatusIcon-Bgt-qPvL.js";import"./CloseButton-BQ2-rMGt.js";import"./chainedFunction-BxZSneMW.js";import"./isNil-Da3VpJ5R.js";import"./useControllableState-DRbqptMX.js";import"./_baseIsEqual-C6NqMIho.js";import"./_getPrototype-Cl_NgycI.js";import"./index-NXaP3oL6.js";import"./index-Chjiymov.js";import"./index-C2uHdBR5.js";import"./index-B3W0xuVG.js";const M=p=>{const{touched:n,errors:r,values:b}=p,{setFieldValue:d}=A(),t=u.useRef(null),f=b.phoneNumbers||[],x=(c,s)=>{if(c.key==="Enter"){c.preventDefault();{const o=document.querySelector(`[name="${s}"]`);o==null||o.focus()}}};return u.useEffect(()=>{t.current&&(t.current.style.height="auto",t.current.style.height=`${t.current.scrollHeight}px`)},[b.customerAddress]),e.jsxs(k,{divider:!0,className:"mb-4",children:[e.jsx("h5",{children:"Basic Information"}),e.jsx("p",{className:"mb-6",children:"Section to configure basic complaint details"}),e.jsx(l,{label:"Customer Name",invalid:!!r.customerName&&n.customerName,errorMessage:r.customerName,children:e.jsx(m,{type:"text",autoComplete:"off",name:"customerName",placeholder:"Customer Name",component:h,onKeyDown:c=>x(c,"customerAddress")})}),e.jsx(l,{label:"Customer Address",invalid:!!r.customerAddress&&n.customerAddress,errorMessage:r.customerAddress,children:e.jsx(m,{as:"textarea",name:"customerAddress",placeholder:"Customer Address",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:1,innerRef:t,style:{overflow:"hidden",resize:"none"}})}),e.jsx(l,{label:"Complaint Number",invalid:!!r.complaintNumber&&n.complaintNumber,errorMessage:r.complaintNumber,children:e.jsx(m,{type:"text",autoComplete:"off",name:"complaintNumber",placeholder:"Complaint Number",component:h})}),e.jsxs(l,{label:"Phone Numbers",invalid:!!r.phoneNumbers&&n.phoneNumbers,children:[f.map((c,s)=>e.jsx(m,{type:"text",autoComplete:"off",name:`phoneNumbers[${s}]`,placeholder:`Phone Number ${s+1}`,component:h,className:"mb-2"},s)),e.jsx(C,{size:"sm",type:"button",onClick:()=>d("phoneNumbers",[...f,""]),children:"Add Phone Number"})]})]})},P=p=>{const{touched:n,errors:r}=p;return e.jsxs(k,{divider:!0,className:"mb-4",children:[e.jsx("h5",{children:"Complaint Details"}),e.jsx("p",{className:"mb-6",children:"Section to configure complaint details"}),e.jsx(l,{label:"Make",invalid:!!r.make&&n.make,errorMessage:r.make,children:e.jsx(m,{type:"text",autoComplete:"off",name:"make",placeholder:"Make",component:h})}),e.jsx(l,{label:"Dealer Name",invalid:!!r.dealerName&&n.dealerName,errorMessage:r.dealerName,children:e.jsx(m,{type:"text",autoComplete:"off",name:"dealerName",placeholder:"Dealer Name",component:h})}),e.jsx(l,{label:"Warranty Status",invalid:!!r.warrantyStatus&&n.warrantyStatus,errorMessage:r.warrantyStatus,children:e.jsxs(m,{as:"select",name:"warrantyStatus",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Select Warranty Status"}),e.jsx("option",{value:"Warranty",children:"Warranty"}),e.jsx("option",{value:"Non-Warranty",children:"Non-Warranty"})]})}),e.jsx(l,{label:"Reported Complaint",invalid:!!r.reportedComplaint&&n.reportedComplaint,errorMessage:r.reportedComplaint,children:e.jsx(m,{as:"textarea",name:"reportedComplaint",placeholder:"Reported Complaint",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 dark:bg-[#1f2937] dark:border-gray-600 dark:text-white dark:placeholder-gray-400",rows:3})})]})},q=E().shape({customerName:i().required("Customer Name is required"),customerAddress:i().required("Customer Address is required"),phoneNumbers:I().of(i().required("Phone Number is required")).min(1,"At least one phone number is required"),complaintNumber:i().nullable(),make:i().nullable(),dealerName:i().nullable(),warrantyStatus:i().nullable(),reportedComplaint:i().nullable()}),W=u.forwardRef((p,n)=>{const{onDiscard:r}=p,b=S(),{id:d}=v(),t=d?"edit":"new",[f,x]=u.useState({customerName:"",customerAddress:"",complaintNumber:"",phoneNumbers:[],make:"",dealerName:"",warrantyStatus:"",reportedComplaint:""});u.useEffect(()=>{t==="edit"&&d&&(async()=>{try{const o=await w.get(`${y}/onsite/${d}`);console.log("API Response:",o.data);const a=o.data.data;x({customerName:a.customerName,customerAddress:a.customerAddress,complaintNumber:a.complaintNumber,phoneNumbers:a.phoneNumbers||[],make:a.make,dealerName:a.dealerName,warrantyStatus:a.warrantyStatus,reportedComplaint:a.reportedComplaint})}catch(o){console.error("Error fetching complaint details:",o),g.push(e.jsx(j,{title:"Error",type:"danger",duration:2500,children:"Failed to fetch complaint details. Please try again."}),{placement:"top-center"})}})()},[d,t]);const c=async(s,{setSubmitting:o})=>{o(!0);try{const a=t==="new"?`${y}/onsite`:`${y}/onsite/${d}`,N=t==="new"?"post":"put";if(console.log("Sending payload:",s),(await w[N](a,s)).status!==(t==="new"?201:200))throw new Error(`Failed to ${t==="new"?"create":"update"} complaint`);g.push(e.jsxs(j,{title:`Complaint ${t==="new"?"Created":"Updated"}`,type:"success",duration:2500,children:["Complaint ",t==="new"?"created":"updated"," successfully."]}),{placement:"top-center"}),b(-1)}catch(a){console.error(`Error ${t==="new"?"creating":"updating"} complaint:`,a),a.response&&console.error("API Response:",a.response.data),g.push(e.jsxs(j,{title:"Error",type:"danger",duration:2500,children:["Failed to ",t==="new"?"create":"update"," complaint. Please try again."]}),{placement:"top-center"})}finally{o(!1)}};return e.jsx(e.Fragment,{children:e.jsx(F,{innerRef:n,initialValues:f,validationSchema:q,onSubmit:c,enableReinitialize:!0,children:({values:s,touched:o,errors:a,isSubmitting:N})=>e.jsx($,{children:e.jsxs(R,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(M,{touched:o,errors:a,values:s}),e.jsx(P,{touched:o,errors:a,values:s})]})}),e.jsxs(D,{className:"-mx-8 px-8 flex items-center justify-between py-4",stickyClass:"border-t bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700",children:[e.jsx("div",{children:e.jsx(C,{size:"sm",className:"ltr:mr-3 rtl:ml-3",type:"button",onClick:r,children:"Discard"})}),e.jsx("div",{className:"md:flex items-center",children:e.jsx(C,{size:"sm",variant:"solid",loading:N,type:"submit",children:t==="new"?"Create Complaint":"Update Complaint"})})]})]})})})})});W.displayName="OnSiteComplaintForm";export{W as default};
