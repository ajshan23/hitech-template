import{r as m,j as e,a7 as I,aj as v,ah as k,ai as f}from"./index-Bj3mz5Pw.js";import{F as W,a as F,c as g,d as b}from"./formik.esm-sXIm4dFv.js";import{c as E,a as j,g as U}from"./index.esm-DZfJtAA7.js";import"./Alert-COxxIF6A.js";import{A as P}from"./index-Wjh0Y8Wg.js";import"./Badge-nyZZIW2G.js";import{B as S}from"./Button-Dhq_u3bq.js";import"./index-DRUN_WVw.js";import"./Card-vVKS0sxe.js";import"./index-C28Iij6M.js";import"./index-BkpwKNL5.js";import"./Dialog-BGMpSbig.js";import"./Drawer-7ZtkgvAT.js";import"./index-qV6DytUs.js";import"./useRootClose-DQLSAAfv.js";import{I as y}from"./Input-9SAYI4Mj.js";import"./index-B5ENYWct.js";import"./index-BLXFL4Zw.js";import{t as w,N}from"./toast-CEafV06e.js";import"./Skeleton-DUNfQ8XH.js";import"./ScrollBar-CgXTrUgH.js";import"./index-C7QHI3ZB.js";import"./Select-bc2POzie.js";import"./index-DhcYxbh9.js";import"./Tag-Bgz3PWLK.js";import{U as C}from"./Upload-Dfm61XMO.js";import{aj as $}from"./toString-CQNPFSTv.js";import"./context-DBklxPP3.js";import"./index-DUqM6xV3.js";import"./Views-Bc58ZmG5.js";import"./get-CS1_jRFf.js";import"./StatusIcon-sOt29h0g.js";import"./CloseButton-PxoRbE_t.js";import"./useColorLevel-10S34ZEH.js";import"./useControllableState-BOyOyjGi.js";import"./_baseIsEqual-WHXuIrZd.js";import"./_getPrototype-Dx9yexOq.js";import"./index-zI0RxmbS.js";import"./index-Chjiymov.js";import"./isNil-DFW_rJgM.js";import"./chainedFunction-BxZSneMW.js";import"./index-DereAiEi.js";import"./index-DUJXqaki.js";const A=({onFileUpload:c,initialImage:r})=>{const[p,n]=m.useState(null);m.useEffect(()=>{r&&n(r)},[r]);const d=i=>{i.length>0&&(n(URL.createObjectURL(i[0])),c(i))},u=i=>{let l=!0;const h=["image/jpeg","image/png"];if(i)for(const o of i)h.includes(o.type)||(l="Please upload a .jpeg or .png file!");return l};return e.jsx("div",{children:e.jsx(C,{className:"cursor-pointer",showList:!1,uploadLimit:1,beforeUpload:u,onChange:d,children:e.jsx(P,{size:80,src:p||"",icon:e.jsx($,{})})})})},L=E().shape({workerName:j().required("Worker Name is required"),phoneNumber:j().required("Phone Number is required").matches(/^\d{10}$/,"Phone Number must be 10 digits"),workerImage:U().nullable()}),ve=()=>{const c=I(),{id:r}=v(),[p,n]=m.useState(!1),[d,u]=m.useState({workerName:"",phoneNumber:"",workerImage:null}),[i,l]=m.useState(null);m.useEffect(()=>{r&&(async()=>{try{const t=(await k.get(`${f}/worker/specific`,{params:{id:r}})).data.data;u({workerName:t.workerName,phoneNumber:t.phoneNumber,workerImage:null}),l(t.workerImage)}catch(a){console.error("Error fetching worker:",a),w.push(e.jsx(N,{title:"Error",type:"danger",duration:2500,children:"Failed to fetch worker data. Please try again."}),{placement:"top-center"})}})()},[r]);const h=async o=>{n(!0);const a=new FormData;a.append("workerName",o.workerName),a.append("phoneNumber",o.phoneNumber),o.workerImage&&a.append("image",o.workerImage),r&&a.append("workerId",r);try{let t;if(r?t=await k.put(`${f}/worker/edit`,a,{headers:{"Content-Type":"multipart/form-data"}}):t=await k.post(`${f}/worker`,a,{headers:{"Content-Type":"multipart/form-data"}}),t.status!==200&&t.status!==201)throw new Error("Failed to save worker");w.push(e.jsx(N,{title:r?"Worker Updated":"Worker Created",type:"success",duration:2500,children:r?"Worker updated successfully.":"Worker created successfully."}),{placement:"top-center"}),c(-1)}catch(t){console.error("Error saving worker:",t),w.push(e.jsx(N,{title:"Error",type:"danger",duration:2500,children:r?"Failed to update worker. Please try again.":"Failed to create worker. Please try again."}),{placement:"top-center"})}finally{n(!1)}};return e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"mb-6",children:r?"Edit Worker":"Create Worker"}),e.jsx(W,{initialValues:d,validationSchema:L,onSubmit:h,enableReinitialize:!0,children:({setFieldValue:o,values:a,touched:t,errors:s})=>e.jsx(F,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(g,{label:"Worker Name",invalid:!!s.workerName&&t.workerName,errorMessage:s.workerName,children:e.jsx(b,{type:"text",autoComplete:"off",name:"workerName",placeholder:"Worker Name",component:y})}),e.jsx(g,{label:"Phone Number",invalid:!!s.phoneNumber&&t.phoneNumber,errorMessage:s.phoneNumber,children:e.jsx(b,{type:"text",autoComplete:"off",name:"phoneNumber",placeholder:"Phone Number",component:y})}),e.jsx(g,{label:"Worker Image",invalid:!!s.workerImage&&t.workerImage,errorMessage:s.workerImage,children:e.jsx(A,{onFileUpload:x=>{x.length>0&&o("workerImage",x[0])},initialImage:i||void 0})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(S,{type:"submit",variant:"solid",loading:p,disabled:p,children:r?"Update Worker":"Create Worker"})})]})})})]})};export{ve as default};
