import{r as m,j as e,a7 as I,aj as v,ah as k,ai as f}from"./index-D8EZYNHx.js";import{F as W,a as F,c as g,d as b}from"./formik.esm-2YDLR01m.js";import{c as E,a as j,g as U}from"./index.esm-B31dl2ce.js";import"./Alert-DbsNRRSF.js";import{A as P}from"./index-RMFzDg-A.js";import"./Badge-dzkq8wnb.js";import{B as S}from"./Button-BAgZyNTE.js";import"./index-356Hsfv7.js";import"./Card-D3euQ4_N.js";import"./index-BhP7YvoW.js";import"./index-CKbZ70H_.js";import"./Dialog-o_keClBI.js";import"./Drawer-Cdfikf9d.js";import"./index-B2aM9vQw.js";import"./useRootClose-CuhFRF3n.js";import{I as y}from"./Input-D5_BSRej.js";import"./index-BGivXdoS.js";import"./index-D6qi2naG.js";import{t as w,N}from"./toast-C7jHvblq.js";import"./Skeleton-lhhyWF6d.js";import"./ScrollBar-C2JZ1DMg.js";import"./index-BDZmxKtV.js";import"./Select-C6GQ0nNK.js";import"./index-wYfgWbp_.js";import"./Tag-D0COJtlv.js";import{U as C}from"./Upload-CTtO2M3U.js";import{aj as $}from"./toString-ayuhG4Ds.js";import"./context-HkwJrTD0.js";import"./index-CsNSl6Kk.js";import"./Views-CgaeU5aH.js";import"./get-DPkZYNvx.js";import"./StatusIcon-CnILfGF9.js";import"./CloseButton-C7TlJk6N.js";import"./useColorLevel-10S34ZEH.js";import"./useControllableState-nlwpxWFS.js";import"./_baseIsEqual-CjnU3fcr.js";import"./_getPrototype-pYDtWiyg.js";import"./index-ByqCL_hN.js";import"./index-Chjiymov.js";import"./isNil-BluEIfBs.js";import"./chainedFunction-BxZSneMW.js";import"./index-BVUIStRM.js";import"./index-BjDSyWEQ.js";const A=({onFileUpload:c,initialImage:r})=>{const[p,n]=m.useState(null);m.useEffect(()=>{r&&n(r)},[r]);const d=i=>{i.length>0&&(n(URL.createObjectURL(i[0])),c(i))},u=i=>{let l=!0;const h=["image/jpeg","image/png"];if(i)for(const o of i)h.includes(o.type)||(l="Please upload a .jpeg or .png file!");return l};return e.jsx("div",{children:e.jsx(C,{className:"cursor-pointer",showList:!1,uploadLimit:1,beforeUpload:u,onChange:d,children:e.jsx(P,{size:80,src:p||"",icon:e.jsx($,{})})})})},L=E().shape({workerName:j().required("Worker Name is required"),phoneNumber:j().required("Phone Number is required").matches(/^\d{10}$/,"Phone Number must be 10 digits"),workerImage:U().nullable()}),ve=()=>{const c=I(),{id:r}=v(),[p,n]=m.useState(!1),[d,u]=m.useState({workerName:"",phoneNumber:"",workerImage:null}),[i,l]=m.useState(null);m.useEffect(()=>{r&&(async()=>{try{const t=(await k.get(`${f}/worker/specific`,{params:{id:r}})).data.data;u({workerName:t.workerName,phoneNumber:t.phoneNumber,workerImage:null}),l(t.workerImage)}catch(a){console.error("Error fetching worker:",a),w.push(e.jsx(N,{title:"Error",type:"danger",duration:2500,children:"Failed to fetch worker data. Please try again."}),{placement:"top-center"})}})()},[r]);const h=async o=>{n(!0);const a=new FormData;a.append("workerName",o.workerName),a.append("phoneNumber",o.phoneNumber),o.workerImage&&a.append("image",o.workerImage),r&&a.append("workerId",r);try{let t;if(r?t=await k.put(`${f}/worker/edit`,a,{headers:{"Content-Type":"multipart/form-data"}}):t=await k.post(`${f}/worker`,a,{headers:{"Content-Type":"multipart/form-data"}}),t.status!==200&&t.status!==201)throw new Error("Failed to save worker");w.push(e.jsx(N,{title:r?"Worker Updated":"Worker Created",type:"success",duration:2500,children:r?"Worker updated successfully.":"Worker created successfully."}),{placement:"top-center"}),c(-1)}catch(t){console.error("Error saving worker:",t),w.push(e.jsx(N,{title:"Error",type:"danger",duration:2500,children:r?"Failed to update worker. Please try again.":"Failed to create worker. Please try again."}),{placement:"top-center"})}finally{n(!1)}};return e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"mb-6",children:r?"Edit Worker":"Create Worker"}),e.jsx(W,{initialValues:d,validationSchema:L,onSubmit:h,enableReinitialize:!0,children:({setFieldValue:o,values:a,touched:t,errors:s})=>e.jsx(F,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(g,{label:"Worker Name",invalid:!!s.workerName&&t.workerName,errorMessage:s.workerName,children:e.jsx(b,{type:"text",autoComplete:"off",name:"workerName",placeholder:"Worker Name",component:y})}),e.jsx(g,{label:"Phone Number",invalid:!!s.phoneNumber&&t.phoneNumber,errorMessage:s.phoneNumber,children:e.jsx(b,{type:"text",autoComplete:"off",name:"phoneNumber",placeholder:"Phone Number",component:y})}),e.jsx(g,{label:"Worker Image",invalid:!!s.workerImage&&t.workerImage,errorMessage:s.workerImage,children:e.jsx(A,{onFileUpload:x=>{x.length>0&&o("workerImage",x[0])},initialImage:i||void 0})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(S,{type:"submit",variant:"solid",loading:p,disabled:p,children:r?"Update Worker":"Create Worker"})})]})})})]})};export{ve as default};
