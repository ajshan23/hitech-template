import{r as a,a9 as T,j as e,ah as u}from"./index-C2iY12u9.js";import{A as E}from"./AdaptableCard-BlvS43n3.js";import{O as I,a0 as K}from"./toString-DHyRyMxG.js";import{D as z}from"./DataTable-BDP2abwy.js";import{B as A}from"./Badge-pgMGCxOU.js";import{B as h}from"./Button-D3qeit4v.js";import{D as M}from"./Drawer-BbgQ8DD9.js";import{P as R}from"./PendingOnSiteComplaintsTableTools-BV3D3geB.js";import"./Card-BOIsTUCi.js";import"./Views-DVTSfLY6.js";import"./index-ByEeNh7A.js";import"./index-D_PTICrA.js";import"./Skeleton-CmOtYc4u.js";import"./Select-DVojIqnk.js";import"./get-C0nIbHDE.js";import"./context-Cji_IDOW.js";import"./index-CgfdXKrB.js";import"./_baseIsEqual-CfyzSPg-.js";import"./_getPrototype-3ogqeYEm.js";import"./index-BP1Ivwmc.js";import"./useColorLevel-10S34ZEH.js";import"./index-DUhMXm8U.js";import"./index-Chjiymov.js";import"./CloseButton-CQqh2RdZ.js";import"./Input-CF3VyKMy.js";import"./isNil-DIAHqIoc.js";import"./debounce-BrVmJBvb.js";const B={Warranty:{dotClass:"bg-green-500"},"Non-Warranty":{dotClass:"bg-red-500"}},H=({searchTerm:o,warrantyFilter:n})=>{const m=a.useRef(null),i=T(),[j,g]=a.useState([]),[w,f]=a.useState(!0),[c,p]=a.useState(1),[l,N]=a.useState(10),[k,b]=a.useState(0),[D,S]=a.useState(!1),[x,y]=a.useState(null);a.useEffect(()=>{p(1)},[o,n]),a.useEffect(()=>{(async()=>{f(!0);try{const t={page:c,limit:l,searchTerm:o||"",complaintStatus:"Sent to Workshop"};n?t.warrantyStatus="true":t.warrantyStatus="false";const r=await u.get("https://mytest.hitechengineeringcompany.in/api/onsite",{params:t});g(r.data.data.data),b(r.data.data.countOfDocuments)}catch(t){console.error("Error fetching complaints:",t)}finally{f(!1)}})()},[c,l,o,n]);const O=s=>{y(s),S(!0)},d=()=>{S(!1),y(null)},C=async s=>{if(x)try{await u.put(`https://mytest.hitechengineeringcompany.in/api/onsite/${x}/status`,{complaintStatus:s});const t={page:c,limit:l,searchTerm:o||"",complaintStatus:"Sent to Workshop"};n?t.warrantyStatus="true":t.warrantyStatus="false";const r=await u.get("https://mytest.hitechengineeringcompany.in/api/onsite",{params:t});g(r.data.data.data),d()}catch(t){console.error("Error changing status:",t)}},W=a.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:s=>e.jsx("span",{className:"capitalize",children:s.row.original.customerName})},{header:"Address",accessorKey:"customerAddress"},{header:"Complaint No.",accessorKey:"complaintNumber"},{header:"Make",accessorKey:"make"},{header:"Warranty",accessorKey:"warrantyStatus",cell:s=>{var r;const t=s.row.original.warrantyStatus;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:((r=B[t])==null?void 0:r.dotClass)||"bg-gray-500"}),e.jsx("span",{className:"capitalize font-semibold",children:t})]})}},{header:"Worker",accessorKey:"attendedPerson",cell:s=>{const t=s.row.original.attendedPerson;return t?e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:t.workerImage,alt:t.workerName,className:"w-10 h-10 rounded-full object-cover"})}):null}},{header:"Actions",id:"actions",cell:s=>e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>i(`/app/onsite/${s.row.original._id}`),children:e.jsx(I,{})}),e.jsx(h,{size:"xs",icon:e.jsx(K,{}),onClick:()=>O(s.row.original._id),children:"Change Status"})]})}],[i]),v=s=>p(s),P=s=>{N(s),p(1)};return e.jsxs(e.Fragment,{children:[e.jsx(z,{ref:m,columns:W,data:j,loading:w,pagingData:{total:k,pageIndex:c,pageSize:l},onPaginationChange:v,onSelectChange:P}),e.jsx(M,{title:"Change Status",isOpen:D,onClose:d,onRequestClose:d,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{block:!0,onClick:()=>C("Pending"),children:"Mark as Pending"}),e.jsx(h,{block:!0,onClick:()=>C("Closed"),children:"Mark as Closed"})]})})]})},he=()=>{const[o,n]=a.useState(""),[m,i]=a.useState(!1);return e.jsxs(E,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Sent to Workshop On-Site Complaints"}),e.jsx(R,{onSearch:n,onFilter:i})]}),e.jsx(H,{searchTerm:o,warrantyFilter:m})]})};export{he as default};
