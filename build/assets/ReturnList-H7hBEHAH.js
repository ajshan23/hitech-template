import{r as t,a7 as F,j as e,ah as p,ai as h}from"./index-Bj3mz5Pw.js";import{A as L}from"./AdaptableCard-CW5rWfWy.js";import{I as T,Y as B,T as H}from"./toString-CQNPFSTv.js";import{D as _,d as q}from"./debounce-Dydopoza.js";import{B as y}from"./Button-Dhq_u3bq.js";import{D as M}from"./Drawer-7ZtkgvAT.js";import{t as v,N as I}from"./toast-CEafV06e.js";import{I as U}from"./Input-9SAYI4Mj.js";import{C as Y}from"./index-C28Iij6M.js";import"./Card-vVKS0sxe.js";import"./Views-Bc58ZmG5.js";import"./index-DhcYxbh9.js";import"./index-DereAiEi.js";import"./Skeleton-DUNfQ8XH.js";import"./Select-bc2POzie.js";import"./get-CS1_jRFf.js";import"./context-DBklxPP3.js";import"./index-Bkx5KVf2.js";import"./useColorLevel-10S34ZEH.js";import"./index-zI0RxmbS.js";import"./index-Chjiymov.js";import"./CloseButton-PxoRbE_t.js";import"./StatusIcon-sOt29h0g.js";import"./chainedFunction-BxZSneMW.js";import"./isNil-DFW_rJgM.js";import"./_baseIsEqual-WHXuIrZd.js";import"./_getPrototype-Dx9yexOq.js";const G=({searchTerm:r,filters:c})=>{const l=t.useRef(null),i=F(),[f,d]=t.useState([]),[b,n]=t.useState(!0),[m,w]=t.useState(1),[u,J]=t.useState(10),[R,E]=t.useState(0),[$,C]=t.useState(!1),[g,S]=t.useState(null);t.useEffect(()=>{w(1)},[r,c]),t.useEffect(()=>{(async()=>{var s,o,N,k;n(!0);try{const j={page:m,limit:u,searchTerm:r||"",returned:!0};c.warranty!==void 0&&(j.warranty=c.warranty);const D=await p.get(`${h}/jobcards/`,{params:j});d((o=(s=D.data)==null?void 0:s.data)==null?void 0:o.data),E((k=(N=D.data)==null?void 0:N.data)==null?void 0:k.countOfDocuments)}catch(j){console.error("Error fetching job cards:",j)}finally{n(!1)}})()},[m,u,r,c]);const O=a=>{S(a),C(!0)},x=()=>{C(!1),S(null)},P=async()=>{var a,s;if(g)try{await p.put(`${h}/jobcards/pending?id=${g}`);const o=await p.get(`${h}/jobcards/`,{params:{page:m,limit:u,searchTerm:r,returned:!0}});d((s=(a=o.data)==null?void 0:a.data)==null?void 0:s.data),v.push(e.jsx(I,{title:"Success",type:"success",children:"Job card marked as pending successfully."})),x()}catch(o){console.error("Error marking job card as pending:",o)}},z=async()=>{var a,s;if(g)try{await p.put(`${h}/jobcards/work-done?id=${g}`);const o=await p.get(`${h}/jobcards/`,{params:{page:m,limit:u,searchTerm:r,returned:!0}});d((s=(a=o.data)==null?void 0:a.data)==null?void 0:s.data),v.push(e.jsx(I,{title:"Success",type:"success",children:"Job card marked as completed successfully."})),x()}catch(o){console.error("Error marking job card as completed:",o)}},K=t.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:a=>e.jsx("span",{className:"capitalize",children:a.row.original.customerName})},{header:"Phone",accessorKey:"phoneNumber"},{header:"Date",accessorKey:"InDate",cell:a=>e.jsx("span",{children:new Date(a.row.original.InDate).toLocaleDateString()})},{header:"Jobcard No.",accessorKey:"jobCardNumber"},{header:"Worker",accessorKey:"worker",cell:a=>{const s=a.row.original.worker;return s?e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.workerImage,alt:s.workerName,className:"w-10 h-10 rounded-full object-cover"})}):e.jsx("div",{className:"flex justify-center",children:e.jsx("span",{children:"-"})})}},{header:"Actions",id:"actions",cell:a=>e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>i(`/app/jobcards/jobcard/${a.row.original._id}`),children:e.jsx(T,{})}),e.jsx(y,{size:"xs",icon:e.jsx(B,{}),onClick:()=>O(a.row.original._id),children:"Change"})]})}],[i]),W=a=>w(a),A=a=>{J(a),w(1)};return e.jsxs(e.Fragment,{children:[e.jsx(_,{ref:l,columns:K,data:f,loading:b,pagingData:{total:R,pageIndex:m,pageSize:u},onPaginationChange:W,onSelectChange:A}),e.jsx(M,{title:"Change Status",isOpen:$,onClose:x,onRequestClose:x,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{block:!0,onClick:P,children:"Pending"}),e.jsx(y,{block:!0,onClick:z,children:"Completed"})]})})]})},Q=({onSearch:r,onFilter:c})=>{const[l,i]=t.useState(!1),f=q(n=>{r(n)},500),d=n=>{f(n.target.value)},b=n=>{i(n),c({warranty:n})};return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[e.jsx(U,{className:"w-full md:w-96 md:mb-0 mb-4",size:"sm",placeholder:"Search returned job cards...",prefix:e.jsx(H,{className:"text-lg"}),onChange:d}),e.jsx("div",{className:"flex items-center",children:e.jsx(Y,{checked:l,onChange:b,children:"Warranty"})})]})},Ne=()=>{const[r,c]=t.useState(""),[l,i]=t.useState({});return e.jsxs(L,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Returned Job Cards"}),e.jsx(Q,{onSearch:c,onFilter:i})]}),e.jsx(G,{searchTerm:r,filters:l})]})};export{Ne as default};
