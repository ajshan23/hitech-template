import{r as t,a7 as G,j as e,ah as l,ai as i}from"./index-Bj3mz5Pw.js";import{A as Q}from"./AdaptableCard-CW5rWfWy.js";import{I as V,Y as X,Z as ee,T as ae}from"./toString-CQNPFSTv.js";import{D as te,d as se}from"./debounce-Dydopoza.js";import{B as b}from"./Button-Dhq_u3bq.js";import{D as P}from"./Drawer-7ZtkgvAT.js";import{t as j,N as x}from"./toast-CEafV06e.js";import{I as z}from"./Input-9SAYI4Mj.js";import{C as re}from"./index-C28Iij6M.js";import"./Card-vVKS0sxe.js";import"./Views-Bc58ZmG5.js";import"./index-DhcYxbh9.js";import"./index-DereAiEi.js";import"./Skeleton-DUNfQ8XH.js";import"./Select-bc2POzie.js";import"./get-CS1_jRFf.js";import"./context-DBklxPP3.js";import"./index-Bkx5KVf2.js";import"./useColorLevel-10S34ZEH.js";import"./index-zI0RxmbS.js";import"./index-Chjiymov.js";import"./CloseButton-PxoRbE_t.js";import"./StatusIcon-sOt29h0g.js";import"./chainedFunction-BxZSneMW.js";import"./isNil-DFW_rJgM.js";import"./_baseIsEqual-WHXuIrZd.js";import"./_getPrototype-Dx9yexOq.js";const oe=({searchTerm:o,filters:c})=>{const h=t.useRef(null),d=G(),[y,u]=t.useState([]),[w,n]=t.useState(!0),[m,S]=t.useState(1),[p,F]=t.useState(10),[K,A]=t.useState(0),[H,v]=t.useState(!1),[g,D]=t.useState(null),[L,I]=t.useState(!1),[J,E]=t.useState(null),[N,B]=t.useState("");t.useEffect(()=>{S(1)},[o,c]),t.useEffect(()=>{(async()=>{var s,r,$,R;n(!0);try{const C={page:m,limit:p,searchTerm:o||"",completed:!0};c.warranty!==void 0&&(C.warranty=c.warranty);const O=await l.get(`${i}/jobcards/`,{params:C});u((r=(s=O.data)==null?void 0:s.data)==null?void 0:r.data),A((R=($=O.data)==null?void 0:$.data)==null?void 0:R.countOfDocuments)}catch(C){console.error("Error fetching job cards:",C)}finally{n(!1)}})()},[m,p,o,c]);const T=a=>{D(a),v(!0)},f=()=>{v(!1),D(null)},W=a=>{E(a),I(!0)},k=()=>{I(!1),E(null),B("")},_=async()=>{var a,s;if(g)try{await l.put(`${i}/jobcards/pending?id=${g}`);const r=await l.get(`${i}/jobcards/`,{params:{page:m,limit:p,searchTerm:o,completed:!0}});u((s=(a=r.data)==null?void 0:a.data)==null?void 0:s.data),j.push(e.jsx(x,{title:"Success",type:"success",children:"Job card marked as pending successfully."})),f()}catch(r){console.error("Error marking job card as pending:",r)}},q=async()=>{var a,s;if(g)try{await l.put(`${i}/jobcards/return?id=${g}`);const r=await l.get(`${i}/jobcards/`,{params:{page:m,limit:p,searchTerm:o,completed:!0}});u((s=(a=r.data)==null?void 0:a.data)==null?void 0:s.data),j.push(e.jsx(x,{title:"Success",type:"success",children:"Job card marked as returned successfully."})),f()}catch(r){console.error("Error marking job card as returned:",r)}},M=async()=>{var a,s;if(!J||!N){j.push(e.jsx(x,{title:"Error",type:"danger",children:"Invoice number is required."}));return}try{await l.put(`${i}/jobcards/bill?id=${J}&invoiceNumber=${N}`);const r=await l.get(`${i}/jobcards/`,{params:{page:m,limit:p,searchTerm:o,completed:!0}});u((s=(a=r.data)==null?void 0:a.data)==null?void 0:s.data),j.push(e.jsx(x,{title:"Success",type:"success",children:"Job card billed successfully."})),k()}catch(r){console.error("Error billing job card:",r),j.push(e.jsx(x,{title:"Error",type:"danger",children:"Failed to bill job card. Please try again."}))}},U=t.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:a=>e.jsx("span",{className:"capitalize",children:a.row.original.customerName})},{header:"Phone",accessorKey:"phoneNumber"},{header:"Date",accessorKey:"InDate",cell:a=>e.jsx("span",{children:new Date(a.row.original.InDate).toLocaleDateString()})},{header:"Jobcard No.",accessorKey:"jobCardNumber"},{header:"Worker",accessorKey:"worker",cell:a=>{const s=a.row.original.worker;return s?e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.workerImage,alt:s.workerName,className:"w-10 h-10 rounded-full object-cover"})}):e.jsx("div",{className:"flex justify-center",children:e.jsx("span",{children:"-"})})}},{header:"Actions",id:"actions",cell:a=>e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>d(`/app/jobcards/jobcard/${a.row.original._id}`),children:e.jsx(V,{})}),e.jsx(b,{size:"xs",icon:e.jsx(X,{}),onClick:()=>T(a.row.original._id),children:"Change"}),e.jsx(b,{size:"xs",icon:e.jsx(ee,{}),onClick:()=>W(a.row.original._id),children:"Bill"})]})}],[d]),Y=a=>S(a),Z=a=>{F(a),S(1)};return e.jsxs(e.Fragment,{children:[e.jsx(te,{ref:h,columns:U,data:y,loading:w,pagingData:{total:K,pageIndex:m,pageSize:p},onPaginationChange:Y,onSelectChange:Z}),e.jsx(P,{title:"Change Status",isOpen:H,onClose:f,onRequestClose:f,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{block:!0,onClick:_,children:"Pending"}),e.jsx(b,{block:!0,onClick:q,children:"Return"})]})}),e.jsx(P,{title:"Bill Job Card",isOpen:L,onClose:k,onRequestClose:k,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(z,{placeholder:"Enter Invoice Number",value:N,onChange:a=>B(a.target.value)}),e.jsx(b,{block:!0,onClick:M,children:"Submit"})]})})]})},ne=({onSearch:o,onFilter:c})=>{const[h,d]=t.useState(!1),y=se(n=>{o(n)},500),u=n=>{y(n.target.value)},w=n=>{d(n),c({warranty:n})};return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[e.jsx(z,{className:"w-full md:w-96 md:mb-0 mb-4",size:"sm",placeholder:"Search completed job cards...",prefix:e.jsx(ae,{className:"text-lg"}),onChange:u}),e.jsx("div",{className:"flex items-center",children:e.jsx(re,{checked:h,onChange:w,children:"Warranty"})})]})},Oe=()=>{const[o,c]=t.useState(""),[h,d]=t.useState({});return e.jsxs(Q,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Completed Job Cards"}),e.jsx(ne,{onSearch:c,onFilter:d})]}),e.jsx(oe,{searchTerm:o,filters:h})]})};export{Oe as default};
