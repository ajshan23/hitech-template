import{r as a,a7 as T,j as e,ah as m,ai as d}from"./index-DHv1yXA-.js";import{A as _}from"./AdaptableCard--eZME5HE.js";import{I as H,F as L,Y as q}from"./toString-C1MnMNc4.js";import{D as F}from"./debounce-BlnRu6wQ.js";import{B as v}from"./Badge-C-g0WcBr.js";import{B as l}from"./Button-B1sPJbu2.js";import{D as U}from"./Dialog-DTeUBQKh.js";import{D as Y}from"./Drawer-C5oVLCVy.js";import{P as G}from"./PendingOnSiteComplaintsTableTools-C1oAyrpS.js";import"./Card-DdIk2Mlj.js";import"./Views-TIXPd6WS.js";import"./index-TQS-sWSx.js";import"./index-CQZdcBFV.js";import"./Skeleton-BvhYX4_T.js";import"./Select-BCtg_heQ.js";import"./get-sgx0T26Q.js";import"./context-Dy1SCCPB.js";import"./index-CLV_f2Cv.js";import"./_baseIsEqual-CmZ2Gl91.js";import"./_getPrototype-muYxfETC.js";import"./index-CT9EfquD.js";import"./useColorLevel-10S34ZEH.js";import"./index-DiRY_fvU.js";import"./index-Chjiymov.js";import"./CloseButton-C-Dut2Ee.js";import"./Input-cPukz7Wb.js";import"./isNil-QKP5f01Q.js";const J={Warranty:{dotClass:"bg-green-500"},"Non-Warranty":{dotClass:"bg-red-500"}},Q={Pending:{dotClass:"bg-amber-500"},Paid:{dotClass:"bg-emerald-500"}},V=({searchTerm:o,warrantyFilter:n})=>{const h=a.useRef(null),u=T(),[P,g]=a.useState([]),[B,S]=a.useState(!0),[i,f]=a.useState(1),[c,D]=a.useState(10),[O,I]=a.useState(0),[E,x]=a.useState(!1),[y,j]=a.useState(null),[M,w]=a.useState(!1),[N,b]=a.useState(null);a.useEffect(()=>{f(1)},[o,n]),a.useEffect(()=>{(async()=>{S(!0);try{const s={page:i,limit:c,searchTerm:o||"",complaintStatus:"Closed"};n?s.warrantyStatus="true":s.warrantyStatus="false";const r=await m.get(`${d}/onsite`,{params:s});g(r.data.data.data),I(r.data.data.countOfDocuments)}catch(s){console.error("Error fetching complaints:",s)}finally{S(!1)}})()},[i,c,o,n]);const $=t=>{j(t),x(!0)},p=()=>{x(!1),j(null)},z=async()=>{if(y)try{await m.put(`${d}/onsite/${y}/payment-status`,{paymentStatus:"Paid"});const t={page:i,limit:c,searchTerm:o||"",complaintStatus:"Closed"};n?t.warrantyStatus="true":t.warrantyStatus="false";const s=await m.get(`${d}/onsite`,{params:t});g(s.data.data.data),p()}catch(t){console.error("Error updating payment status:",t)}},A=t=>{b(t),w(!0)},C=()=>{w(!1),b(null)},k=async t=>{if(N)try{await m.put(`${d}/onsite/${N}/status`,{complaintStatus:t});const s={page:i,limit:c,searchTerm:o||"",complaintStatus:"Closed"};n?s.warrantyStatus="true":s.warrantyStatus="false";const r=await m.get(`${d}/onsite`,{params:s});g(r.data.data.data),C()}catch(s){console.error("Error changing status:",s)}},K=a.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:t=>e.jsx("span",{className:"capitalize",children:t.row.original.customerName})},{header:"Address",accessorKey:"customerAddress"},{header:"Complaint No.",accessorKey:"complaintNumber"},{header:"Make",accessorKey:"make"},{header:"Warranty",accessorKey:"warrantyStatus",cell:t=>{var r;const s=t.row.original.warrantyStatus;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:((r=J[s])==null?void 0:r.dotClass)||"bg-gray-500"}),e.jsx("span",{className:"capitalize font-semibold",children:s})]})}},{header:"Worker",accessorKey:"attendedPerson",cell:t=>{const s=t.row.original.attendedPerson;return s?e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.workerImage,alt:s.workerName,className:"w-10 h-10 rounded-full object-cover"})}):null}},{header:"Payment Status",accessorKey:"paymentStatus",cell:t=>{var r;const s=t.row.original.paymentStatus;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:((r=Q[s])==null?void 0:r.dotClass)||"bg-gray-500"}),e.jsx("span",{className:"capitalize font-semibold",children:s})]})}},{header:"Actions",id:"actions",cell:t=>e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>u(`/app/onsite/${t.row.original._id}`),children:e.jsx(H,{})}),e.jsx(l,{size:"xs",icon:e.jsx(L,{}),onClick:()=>$(t.row.original._id),children:"Bill"}),e.jsx(l,{size:"xs",icon:e.jsx(q,{}),onClick:()=>A(t.row.original._id),children:"Change Status"})]})}],[u]),R=t=>f(t),W=t=>{D(t),f(1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{ref:h,columns:K,data:P,loading:B,pagingData:{total:O,pageIndex:i,pageSize:c},onPaginationChange:R,onSelectChange:W}),e.jsxs(U,{isOpen:E,onClose:p,onRequestClose:p,children:[e.jsx("h5",{className:"mb-4",children:"Confirm Billing"}),e.jsx("p",{children:"Are you sure you want to mark this complaint as billed?"}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(l,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:p,children:"Cancel"}),e.jsx(l,{variant:"solid",onClick:z,children:"Confirm"})]})]}),e.jsx(Y,{title:"Change Status",isOpen:M,onClose:C,onRequestClose:C,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{block:!0,onClick:()=>k("Pending"),children:"Mark as Pending"}),e.jsx(l,{block:!0,onClick:()=>k("Sent to Workshop"),children:"Send to Workshop"})]})})]})},ke=()=>{const[o,n]=a.useState(""),[h,u]=a.useState(!1);return e.jsxs(_,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Closed On-Site Complaints"}),e.jsx(G,{onSearch:n,onFilter:u})]}),e.jsx(V,{searchTerm:o,warrantyFilter:h})]})};export{ke as default};
