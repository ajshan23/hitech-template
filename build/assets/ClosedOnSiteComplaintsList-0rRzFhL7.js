import{r as a,a9 as T,j as e,ah as m}from"./index-B7gDcve1.js";import{A as H}from"./AdaptableCard-DWDoig49.js";import{O as _,M as $,a0 as q}from"./toString-BTJzyLo_.js";import{D as L}from"./DataTable-Bg1__MjQ.js";import{B as k}from"./Badge-C_F6d7pz.js";import{B as i}from"./Button-CAnfWXiO.js";import{D as F}from"./Dialog-DvUnFmtE.js";import{D as G}from"./Drawer-DB7Zv6KT.js";import{P as J}from"./PendingOnSiteComplaintsTableTools-DBog_qNR.js";import"./Card-ClSbbZpK.js";import"./Views-BimbbXt4.js";import"./index-BxaiHzCN.js";import"./index-BJgtahsK.js";import"./Skeleton-CipR6sCE.js";import"./Select-BdpL1eB2.js";import"./get-B7Jo_wI6.js";import"./context-Dj6ocMUM.js";import"./index-CUuT-VC2.js";import"./_baseIsEqual-C86fEe5q.js";import"./_getPrototype-BDGNlnFu.js";import"./index-BzaCQqcK.js";import"./useColorLevel-10S34ZEH.js";import"./index-CuJy_WMJ.js";import"./index-Chjiymov.js";import"./CloseButton-CRM9zbV-.js";import"./Input-DDrsmMR1.js";import"./isNil-Bi4sFohX.js";import"./debounce-C-swc0Qo.js";const Q={Warranty:{dotClass:"bg-green-500"},"Non-Warranty":{dotClass:"bg-red-500"}},U={Pending:{dotClass:"bg-amber-500"},Paid:{dotClass:"bg-emerald-500"}},V=({searchTerm:r,warrantyFilter:o})=>{const u=a.useRef(null),d=T(),[v,h]=a.useState([]),[O,y]=a.useState(!0),[l,g]=a.useState(1),[c,P]=a.useState(10),[D,B]=a.useState(0),[M,C]=a.useState(!1),[x,S]=a.useState(null),[I,j]=a.useState(!1),[w,N]=a.useState(null);a.useEffect(()=>{g(1)},[r,o]),a.useEffect(()=>{(async()=>{y(!0);try{const s={page:l,limit:c,searchTerm:r||"",complaintStatus:"Closed"};o?s.warrantyStatus="true":s.warrantyStatus="false";const n=await m.get("https://mytest.hitechengineeringcompany.in/api/onsite",{params:s});h(n.data.data.data),B(n.data.data.countOfDocuments)}catch(s){console.error("Error fetching complaints:",s)}finally{y(!1)}})()},[l,c,r,o]);const E=t=>{S(t),C(!0)},p=()=>{C(!1),S(null)},z=async()=>{if(x)try{await m.put(`https://mytest.hitechengineeringcompany.in/api/onsite/${x}/payment-status`,{paymentStatus:"Paid"});const t={page:l,limit:c,searchTerm:r||"",complaintStatus:"Closed"};o?t.warrantyStatus="true":t.warrantyStatus="false";const s=await m.get("https://mytest.hitechengineeringcompany.in/api/onsite",{params:t});h(s.data.data.data),p()}catch(t){console.error("Error updating payment status:",t)}},K=t=>{N(t),j(!0)},f=()=>{j(!1),N(null)},b=async t=>{if(w)try{await m.put(`https://mytest.hitechengineeringcompany.in/api/onsite/${w}/status`,{complaintStatus:t});const s={page:l,limit:c,searchTerm:r||"",complaintStatus:"Closed"};o?s.warrantyStatus="true":s.warrantyStatus="false";const n=await m.get("https://mytest.hitechengineeringcompany.in/api/onsite",{params:s});h(n.data.data.data),f()}catch(s){console.error("Error changing status:",s)}},W=a.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:t=>e.jsx("span",{className:"capitalize",children:t.row.original.customerName})},{header:"Address",accessorKey:"customerAddress"},{header:"Complaint No.",accessorKey:"complaintNumber"},{header:"Make",accessorKey:"make"},{header:"Warranty",accessorKey:"warrantyStatus",cell:t=>{var n;const s=t.row.original.warrantyStatus;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:((n=Q[s])==null?void 0:n.dotClass)||"bg-gray-500"}),e.jsx("span",{className:"capitalize font-semibold",children:s})]})}},{header:"Worker",accessorKey:"attendedPerson",cell:t=>{const s=t.row.original.attendedPerson;return s?e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.workerImage,alt:s.workerName,className:"w-10 h-10 rounded-full object-cover"})}):null}},{header:"Payment Status",accessorKey:"paymentStatus",cell:t=>{var n;const s=t.row.original.paymentStatus;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:((n=U[s])==null?void 0:n.dotClass)||"bg-gray-500"}),e.jsx("span",{className:"capitalize font-semibold",children:s})]})}},{header:"Actions",id:"actions",cell:t=>e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>d(`/app/onsite/${t.row.original._id}`),children:e.jsx(_,{})}),e.jsx(i,{size:"xs",icon:e.jsx($,{}),onClick:()=>E(t.row.original._id),children:"Bill"}),e.jsx(i,{size:"xs",icon:e.jsx(q,{}),onClick:()=>K(t.row.original._id),children:"Change Status"})]})}],[d]),A=t=>g(t),R=t=>{P(t),g(1)};return e.jsxs(e.Fragment,{children:[e.jsx(L,{ref:u,columns:W,data:v,loading:O,pagingData:{total:D,pageIndex:l,pageSize:c},onPaginationChange:A,onSelectChange:R}),e.jsxs(F,{isOpen:M,onClose:p,onRequestClose:p,children:[e.jsx("h5",{className:"mb-4",children:"Confirm Billing"}),e.jsx("p",{children:"Are you sure you want to mark this complaint as billed?"}),e.jsxs("div",{className:"text-right mt-6",children:[e.jsx(i,{className:"ltr:mr-2 rtl:ml-2",variant:"plain",onClick:p,children:"Cancel"}),e.jsx(i,{variant:"solid",onClick:z,children:"Confirm"})]})]}),e.jsx(G,{title:"Change Status",isOpen:I,onClose:f,onRequestClose:f,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{block:!0,onClick:()=>b("Pending"),children:"Mark as Pending"}),e.jsx(i,{block:!0,onClick:()=>b("Sent to Workshop"),children:"Send to Workshop"})]})})]})},ke=()=>{const[r,o]=a.useState(""),[u,d]=a.useState(!1);return e.jsxs(H,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Closed On-Site Complaints"}),e.jsx(J,{onSearch:o,onFilter:d})]}),e.jsx(V,{searchTerm:r,warrantyFilter:u})]})};export{ke as default};
