import{r as s,a9 as G,j as e,ah as c}from"./index-B7gDcve1.js";import{A as Q}from"./AdaptableCard-DWDoig49.js";import{$ as V,O as X,a0 as Y,F as Z}from"./toString-BTJzyLo_.js";import{D as ee}from"./DataTable-Bg1__MjQ.js";import{B as g}from"./Button-CAnfWXiO.js";import{D as O}from"./Drawer-DB7Zv6KT.js";import{t as A,N as W}from"./toast-Dkbl9R_F.js";import{I as ae}from"./Input-DDrsmMR1.js";import{C as te}from"./index-CUuT-VC2.js";import{d as se}from"./debounce-C-swc0Qo.js";import"./Card-ClSbbZpK.js";import"./Views-BimbbXt4.js";import"./index-BxaiHzCN.js";import"./index-BJgtahsK.js";import"./Skeleton-CipR6sCE.js";import"./Select-BdpL1eB2.js";import"./get-B7Jo_wI6.js";import"./context-Dj6ocMUM.js";import"./index-BzaCQqcK.js";import"./useColorLevel-10S34ZEH.js";import"./index-CuJy_WMJ.js";import"./index-Chjiymov.js";import"./CloseButton-CRM9zbV-.js";import"./StatusIcon-S-EimYFx.js";import"./chainedFunction-BxZSneMW.js";import"./isNil-Bi4sFohX.js";import"./_baseIsEqual-C86fEe5q.js";import"./_getPrototype-BDGNlnFu.js";const re=({searchTerm:n,filters:o})=>{const h=s.useRef(null),d=G(),[f,m]=s.useState([]),[w,i]=s.useState(!0),[p,C]=s.useState(1),[u,P]=s.useState(10),[R,z]=s.useState(0),[_,S]=s.useState(!1),[k,v]=s.useState(null),[F,K]=s.useState([]),[H,D]=s.useState(!1),[x,I]=s.useState(null);s.useEffect(()=>{C(1)},[n,o]),s.useEffect(()=>{(async()=>{var t,r,l,y;i(!0);try{const b={page:p,limit:u,searchTerm:n||"",pending:!0};o.warranty!==void 0&&(b.warranty=o.warranty);const E=await c.get("https://mytest.hitechengineeringcompany.in/api/jobcards/",{params:b});m((r=(t=E.data)==null?void 0:t.data)==null?void 0:r.data),z((y=(l=E.data)==null?void 0:l.data)==null?void 0:y.countOfDocuments)}catch(b){console.error("Error fetching job cards:",b)}finally{i(!1)}})()},[p,u,n,o]);const J=async a=>{v(a),S(!0);try{const t=await c.get("https://mytest.hitechengineeringcompany.in/api/worker/available");K(t.data.data)}catch(t){console.error("Error fetching available workers:",t)}},N=()=>{S(!1),v(null)},$=async a=>{var t,r;if(k)try{await c.put("https://mytest.hitechengineeringcompany.in/api/worker/assign",{workerId:a,jobcardId:k});const l={page:p,limit:u,searchTerm:n||"",pending:!0};o.warranty!==void 0&&(l.warranty=o.warranty);const y=await c.get("https://mytest.hitechengineeringcompany.in/api/jobcards/",{params:l});m((r=(t=y.data)==null?void 0:t.data)==null?void 0:r.data),N()}catch(l){console.error("Error assigning worker:",l)}},L=a=>{I(a),D(!0)},j=()=>{D(!1),I(null)},q=async()=>{var a,t;if(x)try{await c.put(`https://mytest.hitechengineeringcompany.in/api/jobcards/return?id=${x}`);const r=await c.get("https://mytest.hitechengineeringcompany.in/api/jobcards/",{params:{page:p,limit:u,searchTerm:n,pending:!0}});m((t=(a=r.data)==null?void 0:a.data)==null?void 0:t.data),A.push(e.jsx(W,{title:"Success",type:"success",children:"Job card returned successfully."})),j()}catch(r){console.error("Error returning job card:",r)}},B=async()=>{var a,t;if(x)try{await c.put(`https://mytest.hitechengineeringcompany.in/api/jobcards/work-done?id=${x}`);const r=await c.get("https://mytest.hitechengineeringcompany.in/api/jobcards/",{params:{page:p,limit:u,searchTerm:n,pending:!0}});m((t=(a=r.data)==null?void 0:a.data)==null?void 0:t.data),A.push(e.jsx(W,{title:"Success",type:"success",children:"Job card marked as completed successfully."})),j()}catch(r){console.error("Error marking job card as completed:",r)}},T=s.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:a=>e.jsx("span",{className:"capitalize",children:a.row.original.customerName})},{header:"Phone",accessorKey:"phoneNumber"},{header:"Date",accessorKey:"InDate",cell:a=>e.jsx("span",{children:new Date(a.row.original.InDate).toLocaleDateString()})},{header:"Jobcard No.",accessorKey:"jobCardNumber"},{header:"Worker",accessorKey:"worker",cell:a=>{const t=a.row.original.worker;return t?e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:t.workerImage,alt:t.workerName,className:"w-10 h-10 rounded-full object-cover cursor-pointer",onClick:()=>J(a.row.original._id)})}):e.jsx("div",{className:"flex justify-center",children:e.jsx(g,{size:"xs",icon:e.jsx(V,{}),onClick:()=>J(a.row.original._id),children:"Assign"})})}},{header:"Actions",id:"actions",cell:a=>e.jsxs("div",{className:"flex justify-end text-lg gap-2",children:[e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>d(`/app/jobcards/jobcard/${a.row.original._id}`),children:e.jsx(X,{})}),e.jsx(g,{size:"xs",icon:e.jsx(Y,{}),onClick:()=>L(a.row.original._id),children:"Change"})]})}],[d]),M=a=>C(a),U=a=>{P(a),C(1)};return e.jsxs(e.Fragment,{children:[e.jsx(ee,{ref:h,columns:T,data:f,loading:w,pagingData:{total:R,pageIndex:p,pageSize:u},onPaginationChange:M,onSelectChange:U}),e.jsx(O,{title:"Assign Worker",isOpen:_,onClose:N,onRequestClose:N,children:e.jsx("div",{className:"space-y-4",children:F.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-100 rounded",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:a.workerImage,alt:a.workerName,className:"w-10 h-10 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:a.workerName}),e.jsx("p",{className:"text-sm text-gray-500",children:a.phoneNumber})]})]}),e.jsx(g,{size:"xs",onClick:()=>$(a._id),children:"Assign"})]},a._id))})}),e.jsx(O,{title:"Change Status",isOpen:H,onClose:j,onRequestClose:j,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{block:!0,onClick:q,children:"Return"}),e.jsx(g,{block:!0,onClick:B,children:"Completed"})]})})]})},ne=({onSearch:n,onFilter:o})=>{const[h,d]=s.useState(!1),f=se(i=>{n(i)},500),m=i=>{f(i.target.value)},w=i=>{d(i),o({warranty:i})};return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[e.jsx(ae,{className:"w-full md:w-96 md:mb-0 mb-4",size:"sm",placeholder:"Search pending job cards...",prefix:e.jsx(Z,{className:"text-lg"}),onChange:m}),e.jsx("div",{className:"flex items-center",children:e.jsx(te,{checked:h,onChange:w,children:"Warranty"})})]})},Pe=()=>{const[n,o]=s.useState(""),[h,d]=s.useState({});return e.jsxs(Q,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Pending Job Cards"}),e.jsx(ne,{onSearch:o,onFilter:d})]}),e.jsx(re,{searchTerm:n,filters:h})]})};export{Pe as default};
