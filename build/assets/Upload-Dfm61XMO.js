import{r,j as e,ag as H,c as b}from"./index-Bj3mz5Pw.js";import{c as Q}from"./_baseIsEqual-WHXuIrZd.js";import{a as W,b as X,c as ee}from"./index-DUJXqaki.js";import{B as se}from"./Button-Dhq_u3bq.js";import{C as ae}from"./CloseButton-PxoRbE_t.js";import{t as te,N as le}from"./toast-CEafV06e.js";function me(l,o){const c=r.useRef(!1);r.useEffect(()=>()=>{c.current=!1},[]),r.useEffect(()=>{if(c.current)return l();c.current=!0},o)}const re=1e3,ie=l=>Math.round(l/re),v=({children:l})=>e.jsx("span",{className:"text-4xl",children:l}),O=l=>{const{file:o,children:c}=l,{type:d,name:i,size:t}=o,f=()=>d.split("/")[0]==="image"?e.jsx("img",{className:"upload-file-image",src:URL.createObjectURL(o),alt:`file preview ${i}`}):d==="application/zip"?e.jsx(v,{children:e.jsx(W,{})}):d==="application/pdf"?e.jsx(v,{children:e.jsx(X,{})}):e.jsx(v,{children:e.jsx(ee,{})});return e.jsxs("div",{className:"upload-file",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"upload-file-thumbnail",children:f()}),e.jsxs("div",{className:"upload-file-info",children:[e.jsx("h6",{className:"upload-file-name",children:i}),e.jsxs("span",{className:"upload-file-size",children:[ie(t)," kb"]})]})]}),c]})};O.displayName="UploadFileItem";const L=l=>Object.keys(l).map(o=>l[o]),ne=r.forwardRef((l,o)=>{const{accept:c,beforeUpload:d,disabled:i=!1,draggable:t=!1,fileList:f=[],fileListClass:C,fileItemClass:I,multiple:E,onChange:g,onFileRemove:h,showList:B=!0,tip:R,uploadLimit:u,children:x,className:S,field:w,...F}=l,y=r.useRef(null),[p,j]=r.useState(f),[$,N]=r.useState(!1),{themeColor:z,primaryColorLevel:J}=H();r.useEffect(()=>{JSON.stringify(p)!==JSON.stringify(f)&&j(f)},[JSON.stringify(f)]);const U=(a="")=>{te.push(e.jsx(le,{type:"danger",duration:2e3,children:a||"Upload Failed!"}),{placement:"top-center"})},k=(a,s)=>{if(a)for(const n of a)s.push(n);return s},P=a=>{let s=Q(p);return typeof u=="number"&&u!==0&&Object.keys(s).length>=u?(u===1&&(s.shift(),s=k(a,s)),L({...s})):(s=k(a,s),L({...s}))},T=a=>{const{files:s}=a.target;let n=!0;if(d){if(n=d(s,p),n===!1){U();return}if(typeof n=="string"&&n.length>0){U(n);return}}if(n){const m=P(s);j(m),g==null||g(m,p)}},V=a=>{const s=p.filter((n,m)=>m!==a);j(s),h==null||h(s)},M=a=>{var s;i||(s=y.current)==null||s.click(),a.stopPropagation()},A=()=>!t&&!x?e.jsx(se,{disabled:i,onClick:a=>a.preventDefault(),children:"Upload"}):t&&!x?e.jsx("span",{children:"Choose a file or drag and drop here"}):x,K=r.useCallback(()=>{t&&N(!1)},[t]),Y=r.useCallback(()=>{t&&!i&&N(!0)},[t,i]),Z=r.useCallback(()=>{t&&N(!1)},[t]),_={onDragLeave:K,onDragOver:Y,onDrop:Z},D=`border-${z}-${J}`,q=b("upload",t&&"upload-draggable",t&&!i&&`hover:${D}`,t&&i&&"disabled",$&&D,S),G=b("upload-input",t&&"draggable");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:o,className:q,...t?_:{onClick:M},...F,children:[e.jsx("input",{ref:y,className:G,type:"file",disabled:i,multiple:E,accept:c,title:"",value:"",onChange:T,...w,...F}),A()]}),R,B&&e.jsx("div",{className:b("upload-file-list",C),children:p.map((a,s)=>e.jsx(O,{file:a,className:I,children:e.jsx(ae,{className:"upload-file-remove",onClick:()=>V(s)})},a.name+s))})]})});ne.displayName="Upload";export{ne as U,me as u};
