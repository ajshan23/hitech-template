import{r as t,a7 as B,j as e,ah as R,ai as P}from"./index-Bj3mz5Pw.js";import{A as E}from"./AdaptableCard-CW5rWfWy.js";import{I as L,T as K,U as T,V as A,W as H}from"./toString-CQNPFSTv.js";import{D as U,d as W}from"./debounce-Dydopoza.js";import{B as M}from"./Badge-nyZZIW2G.js";import{I as _}from"./Input-9SAYI4Mj.js";import{B as g}from"./Button-Dhq_u3bq.js";import{D as $}from"./Drawer-7ZtkgvAT.js";import{F as q,a as G,b as Q,c as F}from"./formik.esm-sXIm4dFv.js";import{C as c}from"./index-C28Iij6M.js";import{L as V}from"./LinkButton-BqIn3mOQ.js";import"./Card-vVKS0sxe.js";import"./Views-Bc58ZmG5.js";import"./index-DhcYxbh9.js";import"./index-DereAiEi.js";import"./Skeleton-DUNfQ8XH.js";import"./Select-bc2POzie.js";import"./get-CS1_jRFf.js";import"./context-DBklxPP3.js";import"./index-Bkx5KVf2.js";import"./isNil-DFW_rJgM.js";import"./useColorLevel-10S34ZEH.js";import"./index-zI0RxmbS.js";import"./index-Chjiymov.js";import"./CloseButton-PxoRbE_t.js";import"./index-DUqM6xV3.js";import"./_baseIsEqual-WHXuIrZd.js";import"./_getPrototype-Dx9yexOq.js";const X={Completed:{dotClass:"bg-emerald-500"},Pending:{dotClass:"bg-amber-500"},Cancelled:{dotClass:"bg-red-500"},Returned:{dotClass:"bg-blue-500"},Billed:{dotClass:"bg-purple-500"},Created:{dotClass:"bg-gray-500"}},Y=({searchTerm:o,filters:r})=>{const d=t.useRef(null),i=B(),[j,f]=t.useState([]),[C,h]=t.useState(!0),[l,m]=t.useState(1),[a,x]=t.useState(10),[u,I]=t.useState(0);t.useEffect(()=>{m(1)},[o,r]),t.useEffect(()=>{(async()=>{var b,p,w,y,S,D,v,k;h(!0);try{const n={page:l,limit:a,searchTerm:o||""};r.warranty!==void 0&&(n.warranty=r.warranty),(b=r.status)!=null&&b.includes("Returned")&&(n.returned=!0),(p=r.status)!=null&&p.includes("Pending")&&(n.pending=!0),(w=r.status)!=null&&w.includes("Completed")&&(n.completed=!0),(y=r.status)!=null&&y.includes("Billed")&&(n.billed=!0);const N=await R.get(`${P}/jobcards/`,{params:n});console.log(N),f((D=(S=N.data)==null?void 0:S.data)==null?void 0:D.data),I((k=(v=N.data)==null?void 0:v.data)==null?void 0:k.countOfDocuments)}catch(n){console.error("Error fetching job cards:",n)}finally{h(!1)}})()},[l,a,o,r]);const J=t.useMemo(()=>[{header:"Customer Name",accessorKey:"customerName",cell:s=>e.jsx("span",{className:"capitalize",children:s.row.original.customerName})},{header:"Phone",accessorKey:"phoneNumber"},{header:"In-Date",accessorKey:"InDate",cell:s=>e.jsx("span",{children:new Date(s.row.original.InDate).toLocaleDateString()})},{header:"Out-Date",accessorKey:"OutDate",cell:s=>e.jsx("span",{children:s.row.original.OutDate?new Date(s.row.original.OutDate).toLocaleDateString():"-"})},{header:"Jobcard No.",accessorKey:"jobCardNumber"},{header:"Status",accessorKey:"jobCardStatus",cell:s=>{var p;const b=s.row.original.jobCardStatus;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:((p=X[b])==null?void 0:p.dotClass)||"bg-gray-500"}),e.jsx("span",{className:"capitalize font-semibold",children:b})]})}},{header:"Actions",id:"actions",cell:s=>e.jsx("div",{className:"flex justify-end text-lg",children:e.jsx("span",{className:"cursor-pointer p-2 hover:text-green-500",onClick:()=>i(`/app/jobcards/jobcard/${s.row.original._id}`),children:e.jsx(L,{})})})}],[i]),O=s=>m(s),z=s=>{x(s),m(1)};return e.jsx(U,{ref:d,columns:J,data:j,loading:C,pagingData:{total:u,pageIndex:l,pageSize:a},onPaginationChange:O,onSelectChange:z})},Z=({onSearch:o,onFilter:r})=>{const[d,i]=t.useState(!1),j=t.useRef(null),f=W(a=>{o(a)},500),C=a=>{f(a.target.value)},h=()=>i(!0),l=()=>i(!1),m=a=>{r({status:a.status.length>0?a.status:void 0,warranty:a.warranty??void 0}),l()};return e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[e.jsx(_,{ref:j,className:"w-full md:w-96 md:mb-0 mb-4",size:"sm",placeholder:"Search job cards...",prefix:e.jsx(K,{className:"text-lg"}),onChange:C}),e.jsx(g,{size:"sm",className:"block lg:inline-block md:mb-0 mb-4",icon:e.jsx(T,{}),onClick:h,children:"Filter"}),e.jsx(g,{block:!0,size:"sm",icon:e.jsx(A,{}),className:"block lg:inline-block md:mb-0 mb-4",children:"Export"}),e.jsx(V,{to:"/app/jobcards/jobcard-new",block:!0,variant:"solid",size:"sm",icon:e.jsx(H,{}),className:"block lg:inline-block md:mb-0 mb-4",children:"Add Job Card"}),e.jsx($,{title:"Filter Job Cards",isOpen:d,onClose:l,onRequestClose:l,footer:e.jsxs("div",{className:"text-right w-full",children:[e.jsx(g,{size:"sm",className:"mr-2",onClick:l,children:"Cancel"}),e.jsx(g,{size:"sm",variant:"solid",type:"submit",form:"filter-form",children:"Query"})]}),children:e.jsx(q,{initialValues:{status:[],warranty:null},onSubmit:m,children:({values:a,setFieldValue:x})=>e.jsx(G,{id:"filter-form",children:e.jsxs(Q,{children:[e.jsxs(F,{children:[e.jsx("h6",{className:"mb-4",children:"Job Card Status"}),e.jsxs(c.Group,{vertical:!0,value:a.status,onChange:u=>x("status",u),children:[e.jsx(c,{className:"mb-3",value:"Pending",children:"Pending"}),e.jsx(c,{className:"mb-3",value:"Completed",children:"Completed"}),e.jsx(c,{className:"mb-3",value:"Returned",children:"Returned"}),e.jsx(c,{className:"mb-3",value:"Billed",children:"Billed"})]})]}),e.jsxs(F,{children:[e.jsx("h6",{className:"mb-4",children:"Warranty Status"}),e.jsx(c,{checked:a.warranty===!0,onChange:u=>x("warranty",u?!0:null),children:"Under Warranty"})]})]})})})})]})},Fe=()=>{const[o,r]=t.useState(""),[d,i]=t.useState({});return e.jsxs(E,{className:"h-full",bodyClass:"h-full",children:[e.jsxs("div",{className:"lg:flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"mb-4 lg:mb-0",children:"Job Cards"}),e.jsx(Z,{onSearch:r,onFilter:i})]}),e.jsx(Y,{searchTerm:o,filters:d})]})};export{Fe as default};
